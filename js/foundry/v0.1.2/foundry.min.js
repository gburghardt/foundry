/*! foundry 2014-05-05 */
;var Oxydizr={};Oxydizr.FrontController=function FrontController(){this.events={};this.controllers={};this.handleEvent=this.handleEvent.bind(this);this.handleEnterpress=this.handleEnterpress.bind(this)};Oxydizr.FrontController.prototype={catchErrors:false,controllers:null,element:null,errorHandler:{handleError:function(b,a,d,c,g,f,e){console.error(b);console.log({controller:a,event:d,element:c,params:g,action:f,controllerId:e});return true}},events:null,constructor:Oxydizr.FrontController,destructor:function(){if(this.controllers){for(var b in this.controllers){if(this.controllers.hasOwnProperty(b)){this.unregisterController(this.controllers[b]);this.controllers[b]=null}}this.controllers=null}if(this.events){for(var a in this.events){if(this.events.hasOwnProperty(a)){this._removeEvent(this.element,a,this.events[a])}}this.events=null}this.element=null},init:function(a){if(a){this.element=a}if(!this.element){throw new Error("Missing required argument: element")}this.registerEvents("click","submit");return this},_addEvent:function(b,a,c){if(!this.events[a]){this.events[a]=c;this._addEventListener(b,c.name,c.handler,c.capture)}},_addEventListener:function(c,b,d,a){c.addEventListener(b,d,a)},_createDelegateId:function(){var a=1000;return function(){return String(++a)}}(),_getActions:function(b){var a=b.getAttribute("data-actions");if(!a||/^\s*$/.test(a)){return[]}else{return a.replace(/^\s+|\s+$/g,"").split(/[.\s+]/g)}},_getMethodFromAction:function(a,c,b){var d=null;if(a[c]&&a[c].name===(b.__type||b.type)){d=c}else{if(a.handleAction){d="handleAction"}}return d},_getParams:function(c,b){var a=b.getAttribute("data-action-params");return(a)?JSON.parse(a):{}},handleEnterpress:function(a){if(a.keyCode===13){a.__type="enterpress";this.handleEvent(a)}},_handleError:function(b,a,f,e,d,c,g){if(a&&a.handleActionError){return a.handleActionError(b,d,c,g,e,a,f)}else{if(this.errorHandler){return this.errorHandler.handleActionError(b,a,d,c,g,e,f)}}return false},handleEvent:function(a){this._patchEvent(a);this._propagateEvent(a.target,a);this._unpatchEvent(a)},_invokeAction:function(f,e,d,c,g){var a=this.controllers[f]||null,h=null;if(!a){d.stop();throw new Error("No controller registered for "+f)}else{if(h=this._getMethodFromAction(a,e,d)){if(this.catchErrors){try{a[h](d,c,g,e)}catch(b){d.stop();if(!this._handleError(b,a,f,e,d,c,g)){throw b}}}else{a[h](d,c,g,e)}}}},_patchEvent:function(a){a.__isStopped=false;a.__stopPropagation=a.stopPropagation;a.stopPropagation=function(){a.__stopPropagation();this.__isStopped=true};a.__stop=a.stop||null;a.stop=function(){if(this.__stop){this.__stop()}this.preventDefault();this.stopPropagation()}},_propagateEvent:function(h,a){var g=this._getActions(h),e=this._getParams(a,h),c,f,d;for(var j=0,b=g.length;j<b;j+=2){c=g[j];f=g[j+1];d=e[c+"."+f]||{};this._invokeAction(c,f,a,h,d);if(a.__isStopped){break}}if(a.__isStopped||h===this.element){}else{if(h.parentNode){this._propagateEvent(h.parentNode,a)}}},_registerEvent:function(a){var b={name:a,handler:this.handleEvent,capture:false};if(a==="enterpress"){b.name="keypress";b.handler=this.handleEnterpress}else{if(a==="focus"||a==="blur"){b.capture=true}}this._addEvent(this.element,a,b)},registerEvents:function(){for(var a=0,b=arguments.length;a<b;a++){this._registerEvent(arguments[a])}return this},registerController:function(a){var b=a.controllerId||(a.controllerId=this._createDelegateId());if(this.controllers[b]){throw new Error("Cannot register duplicate delegate Id: "+b)}this.controllers[b]=a;a.onControllerRegistered(this,b);return b},_removeEvent:function(b,a,c){if(this.events[a]){this._removeEventListener(b,c.name,c.handler,c.capture);this.events[a]=this.events[a].handler=null}},_removeEventListener:function(c,b,d,a){c.removeEventListener(b,d,a)},_unpatchEvent:function(a){a.stopPropagation=a.__stopPropagation;a.stop=a.__stop||null;a.__stop=a.__stopPropagation=a.__isStopped=null},unregisterController:function(a){var b=a.controllerId;if(!b||!this.controllers[a.controllerId]){return false}else{this.controllers[a.controllerId]=null;delete this.controllers[a.controllerId];a.onControllerUnregistered(this);return true}}};this.Hypodermic={};(function(g){var f=["applicationCache","console","document","localStorage","location","navigator","screen","sessionStorage"],b={global:g};for(var d=0,c,e=f.length;d<e;d++){c=f[d];if(c in g){b[c]=g[c]}}function a(i){if(!i){throw new Error("Missing required argument: configs")}var k=new Hypodermic.DependencyResolver(this),j=new Hypodermic.ObjectFactory(this,k),h=Object.create(b);h.container=this;this.resolve=function(o,m){var l=null,n=i[o],p={};if(h[o]){l=h[o]}else{if(!n){if(m){throw new Error("No configuration found for "+o)}}else{if(n.template){throw new Error("Cannot create resolve template config: "+o)}else{if(n.factory){l=j.createInstanceFromFactory(n)}else{l=j.createInstance(n,n.constructorArgs)}if(n.singleton){h[o]=l}k.injectDependencies(l,n,p);while(n=i[n.parent]){k.injectDependencies(l,n,p)}}}}return l}}g.Hypodermic.Container=a})(this);(function(c){function f(g){this.container=g}f.prototype={container:null,constructor:f,findDependency:function(i){var g=null,h;if(a(i)){g=this.container.resolve(i,true)}else{if("value" in i){g=i.value}else{throw new Error("No dependency value found. Missing one of 'id', 'value' or 'factory'")}}return g},injectDependencies:function(g,i,l){if(!i.properties){return}var k=i.properties,j,h,m;for(j in k){if(k.hasOwnProperty(j)&&!l[j]){m="set"+b(j);h=this.findDependency(k[j]);if(e(g[m])){g[m](h)}else{g[j]=h}l[j]=true}}}};c.Hypodermic.DependencyResolver=f;var d=Object.prototype.toString;function b(g){return g.charAt(0).toUpperCase()+g.substring(1,g.length)}function e(g){return d.call(g)==="[object Function]"}function a(g){return d.call(g)==="[object String]"}})(this);(function(global){function ObjectFactory(container,dependencyResolver){this.container=container;this.dependencyResolver=dependencyResolver}ObjectFactory.prototype={container:null,dependencyResolver:null,constructor:ObjectFactory,createInstance:function(config,constructorDependencies){if(!config.type){throw new Error("Missing required argument: config.type")}var Klass=this._getClassReference(config.type),instance=null,args=null;if(!Klass){throw new Error("Class "+config.type+" not found.")}else{if(Klass.constructor===Function){instance=Object.create(Klass.prototype);if(constructorDependencies){args=this._getConstructorArgs(constructorDependencies);Klass.apply(instance,args)}else{Klass.call(instance)}}else{instance=Klass}}return instance},createInstanceFromFactory:function(config){if(!config.factory.id){throw new Error("Missing required argument: config.factory.id")}var factoryInfo=config.factory,factory=this.container.resolve(factoryInfo.id,true),method=factoryInfo.method||"createInstance",args=[],dependency,i,length;if(factoryInfo.args&&factoryInfo.args.length){for(i=0,length=factoryInfo.args.length;i<length;i++){args.push(this.dependencyResolver.findDependency(factoryInfo.args[i]))}}else{args.push(factoryInfo.type)}if(!factory[method]){throw new Error("No method called "+method+" exists on the factory object registered as "+factoryInfo.id)}dependency=factory[method].apply(factory,args);return dependency},_getClassReference:function(className){var Klass=_classCache[className]||null;if(!Klass&&/^[a-zA-Z][\w.$]+$/.test(className)){try{Klass=global.eval(className)}catch(error){Klass=null}}if(Klass){_classCache[className]=Klass}return Klass},_getConstructorArgs:function(dependencies){var args=[];for(var i=0,length=dependencies.length;i<length;i++){args.push(this.dependencyResolver.findDependency(dependencies[i]))}return args}};global.Hypodermic.ObjectFactory=ObjectFactory;var _classCache={};var conditionalClasses=["Array","Boolean","Date","document","DocumentFragment","DOMParser","Error","FileReader","Function","location","navigator","Number","Object","RegExp","String","XMLHttpRequest"];var i,length,x;for(i=0,length=conditionalClasses.length;i<length;i++){x=conditionalClasses[i];if(global[x]!==undefined){_classCache[x]=global[x]}}})(this);this.Module=this.Module||{};(function(){function Factory(){}Factory.prototype={objectFactory:null,constructor:Factory,destructor:function destructor(){this.objectFactory=null},getInstance:function getInstance(type){var instance=null,Klass=null;if(this.objectFactory){instance=this.objectFactory.getInstance(type)}if(!instance){if(/^[a-zA-Z][a-zA-Z0-9.]+[a-zA-Z0-9]$/.test(type)){try{Klass=eval(type)}catch(error){throw new Error("Class name "+type+" does not exist")}if(!Klass){throw new Error("Class name "+type+" does not exist")}else{if(typeof Klass!=="function"){throw new Error("Class name "+type+" is not a constructor function")}}instance=new Klass()}else{throw new Error("Cannot instantiate invalid type: "+type)}}return instance}};Module.Factory=Factory})();Module.FrontControllerModuleObserver=function FrontControllerModuleObserver(a){this.frontController=a||null};Module.FrontControllerModuleObserver.prototype={frontController:null,constructor:Module.FrontControllerModuleObserver,onModuleCreated:function(b,a,c){b.controllerId=b.controllerId||b.options.controllerId||b.guid},onModuleRegistered:function(a,b){this.frontController.registerController(a)},onModuleUnregistered:function(a){this.frontController.unregisterController(a)}};(function(){function i(){this.init=B;this.destructor=p;this.setElement=y;this.setManager=n;this.setOptions=C;var s=this,k=false,u={resizeTimeout:250,scrollTimeout:250},E=_scrollTimer=_manager=_element=_document=_window=_resizeTimer=null,t=_scrollTop=_viewportHeight=_viewportWidth=0;function B(){if(k){throw new Error("Cannot re-initialize Module.LazyLoader.")}else{if(!_manager){throw new Error("Missing required property: manager. lazyLoader.setManager(...) to fix this error")}else{if(!_element){throw new Error("Missing required property: element. lazyLoader.setElement(...) to fix this error")}}}v();z();if(!E.scrollTop&&!E.scrollLeft){E=null}k=true;return s}function z(){var I=_element.querySelectorAll("[data-module-lazyload]"),H,G;var F=d.create(x());for(H=0;H<I.length;H++){G=I[H];if(F.isVisible(G)){o(G,"scrollto")}}}function o(G,H){var F=G.getAttribute("data-module-lazyload");if(F==="any"||new RegExp(H).test(F)){if(_manager.createModules(G,true).length){G.removeAttribute("data-module-lazyload");G.setAttribute("data-module-lazyloaded",F)}}G=null}function p(){if(_element){D();_element=_document=E=_window=null}if(_scrollTimer){clearTimeout(_scrollTimer);_scrollTimer=null}if(_resizeTimer){clearTimeout(_resizeTimer);_resizeTimer=null}_manager=u.scrollElement=u=s=null}function w(G,F,H){if(F==="resize"){H.oldresize=G.onresize||null;G.onresize=H}else{if(G.addEventListener){G.addEventListener(F,H,true)}else{if(F==="scroll"){G.onscroll=H}else{G.attachEvent("on"+F,H)}}}}function v(){w(_element,"mouseover",l);w(_document,"scroll",j);w(_window,"resize",q)}function x(){if(E===null){if(_document.body.scrollTop||_document.body.scrollLeft){E=_document.body}else{E=_document.documentElement}}return E}function l(F){F=F||window.event;F.target=F.target||F.srcElement;if(F.target.getAttribute("data-module-lazyload")){o(F.target,F.type)}}function j(F){A(_document,"scroll",j);if(_scrollTimer){clearInterval(_scrollTimer)}_scrollTimer=setInterval(r,u.scrollTimeout)}function r(){var H=x(),G=H.scrollLeft,F=H.scrollTop;if(G!=t||F!=_scrollTop){clearInterval(_scrollTimer);w(_document,"scroll",j);t=G;_scrollTop=F;z()}}function q(F){A(_window,"resize",q);if(_resizeTimer){clearInterval(_resizeTimer)}_resizeTimer=setInterval(m,u.resizeTimeout)}function m(){var F=_document.documentElement.clientHeight,G=_document.documentElement.clientWidth;if(G!==_viewportWidth||F!==_viewportHeight){clearInterval(_resizeTimer);w(_window,"resize",q);_viewportHeight=F;_viewportWidth=G;z()}}function A(G,F,H){if(F==="resize"){G.onresize=H.oldresize||null;H.oldresize=null}else{if(G.removeEventListener){G.removeEventListener(F,H,true)}else{if(F==="scroll"){G.onscroll=null}else{G.detachEvent("on"+F,H)}}}}function D(){A(_element,"mouseover",l);A(_document,"scroll",j);A(_window,"resize",q)}function y(F){_element=F;_document=_element.ownerDocument;_window=_document.defaultView;F=null;return s}function n(F){_manager=F;F=null;return s}function C(G){if(G){for(var F in G){if(G.hasOwnProperty(F)){u[F]=G[F]}}}G=null;return s}}function d(){}d.prototype={bottom:0,height:0,left:0,right:0,top:0,width:0,constructor:d,isBottomInBounds:function h(j){return(j.top+j.height<=this.top+this.height&&j.top+j.height>this.top)?true:false},isLeftInBounds:function c(j){return(j.left>=this.left&&j.left<this.left+this.width)?true:false},isRightInBounds:function f(j){return(j.left+j.width<=this.left+this.width&&j.left+j.width>this.left)?true:false},isTopInBounds:function a(j){return(j.top>=this.top&&j.top<this.top+this.height)?true:false},isVisible:function g(k){var l=false;var j=this._getPosition(k);if((this.isRightInBounds(j)||this.isLeftInBounds(j))&&(this.isTopInBounds(j)||this.isBottomInBounds(j))){l=true}return l},_getPosition:function b(k){var l=k.offsetParent;var j={top:k.offsetTop,left:k.offsetLeft,width:k.offsetWidth,height:k.offsetHeight};while(l=l.offsetParent){j.top+=l.offsetTop;j.left+=l.offsetLeft}return j}};d.create=function e(k){var j=new this();j.top=k.scrollTop;j.left=k.scrollLeft;j.width=k.clientWidth;j.height=k.clientHeight;j.right=k.offsetWidth-(j.left+j.width);j.bottom=k.offsetHeight-j.top-j.height;return j};Module.LazyLoader=i})();(function(){function b(){}b.prototype={baseClassName:"module",defaultModule:null,defaultModuleFocused:false,moduleObserver:{onModuleCreated:function(q,p,r){},onModuleRegistered:function(p,q){},onModuleUnregistered:function(p){}},provider:null,registry:null,groups:null,constructor:Module.Manager,destructor:function m(p){if(Module.manager===this){Module.manager=null}if(this.registry){this._destroyRegistry(p)}if(this.groups){this._destroyGroups()}if(this.provider){if(p){this.provider.destructor()}this.provider=null}if(this.lazyLoader){this.lazyLoader.destructor();this.lazyLoader=null}},_destroyGroups:function d(){var q,s,p,r;for(q in this.groups){if(this.groups.hasOwnProperty(q)){s=this.groups[q];for(p=0,r=s.length;p<r;p++){s[p]=null}this.groups[q]=null}}this.groups=null},_destroyRegistry:function l(r){var p,q;for(p in this.registry){if(this.registry.hasOwnProperty(p)){q=this.registry[p];this.moduleObserver.onModuleUnregistered(q.module);if(r){q.module.destructor(true)}q.module=null;this.registry[p]=null}}this.registry=null},init:function n(){this.provider=this.provider||new Module.Provider();this.provider.factory=this.provider.factory||new Module.Factory();this.provider.manager=this;this.provider.moduleObserver=this.moduleObserver;this.registry=this.registry||{};this.groups=this.groups||{};Module.manager=this;return this},eagerLoadModules:function o(r){var q=r.querySelectorAll("[data-modules]"),p=0;for(p;p<q.length;p++){this.createModules(q[p])}q=null;return this},lazyLoadModules:function e(q,p){this.lazyLoader=(this.lazyLoader||new Module.LazyLoader()).setManager(this).setElement(q).setOptions(p).init();q=p=null;return this},createModule:function j(r,t,p,s){var q=this.provider.createModule(r,t,p);if(s){this.registerModule(t,q)}r=p=null;return q},createModules:function c(r,s){if(!r){throw new Error("Missing required argument: element")}else{if(!s&&r.getAttribute("data-module-lazyload")){return[]}else{if(r.getAttribute("data-module-property")){return[]}}}var p=new Module.MetaData(r),q=[];if(p.mediaMatches()){this.provider.createModules(p,function(v,u,w,t){q.push(v);this.registerModule(w,v);v.init()},this);this.markModulesCreated(r,p)}p=r=null;return q},focusDefaultModule:function f(p){if(this.defaultModule&&!this.defaultModuleFocused){this.defaultModuleFocused=true;this.defaultModule.focus(p)}},initModuleInContainer:function i(s,p,r,y,v,q){var u=new Date();var x={guid:q.guid,createdAt:u,timestamp:u.getTime(),controllerId:q.controllerId},w;if(r.renderData){for(w in r.renderData){if(r.renderData.hasOwnProperty(w)){x[w]=r.renderData[w]}}}var t=y.innerHTML.replace(/#\{([-.\w]+)\}/g,function(z,A){return x[A]||""});s.className+=(" "+this.baseClassName+" "+r.className).replace(/\s{2,}/g," ");s.innerHTML=t;if(r.insert==="top"&&p.firstChild){p.insertBefore(s,p.firstChild)}else{p.appendChild(s)}this.registerModule(v,q);q.init();if(r.autoFocus){q.focus(!!r.autoFocusAnything)}},markModulesCreated:function g(q,p){q.setAttribute("data-modules-created",p.types.join(" "));q.removeAttribute("data-modules");q=p=null},registerModule:function a(q,p){if(p.guid===undefined||p.guid===null){throw new Error("Cannot register module "+q+" without a guid property")}else{if(this.registry[p.guid]){throw new Error("Module "+p.guid+" has already been registered")}}this.registry[p.guid]={module:p,type:q};if(!this.groups[q]){this.groups[q]=[]}this.groups[q].push(p);this.moduleObserver.onModuleRegistered(p,q);p=null},unregisterModule:function h(s){if(!s.guid||!this.registry[s.guid]){s=null;return false}var q=s.guid,t=this.registry[q].type,v=this.groups[t],p=false;this.registry[q].module=null;this.registry[q]=null;delete this.registry[q];if(v){for(var r=0,u=v.length;r<u;r++){if(v[r]===s){v.splice(r,1);p=true;this.moduleObserver.onModuleUnregistered(s);break}}}s=v=null;return p},setDefaultModule:function k(p){if(!this.defaultModule){this.defaultModule=p}p=null}};Module.Manager=b})();(function(d){function a(f){this.options=null;this.types=[];if(f){this.setElement(f)}}a.prototype={element:null,media:null,options:null,types:null,constructor:a,forEach:function e(m,j){var h=0,l=this.types.length,f,k,g;if(l===1){m.call(j,this.element,this.types[0],this.options,0,this)}else{for(h;h<l;++h){k=this.types[h];g=this.options[k]||{};f=m.call(j,this.element,k,g,h,this);if(f===false){break}}}},mediaMatches:function c(){if(!d.matchMedia){throw new Error("This browser does not support JavaScript media queries. Please include a polyfill (https://github.com/paulirish/matchMedia.js)")}if(this.media){console.info("Match media: "+this.media,d.matchMedia(this.media).matches)}return this.media===null||d.matchMedia(this.media).matches},setElement:function b(h){this.element=h;var g=h.getAttribute("data-modules"),f=h.getAttribute("data-module-options");if(!g){throw new Error("Missing required attribute data-modules on "+h.nodeName+"."+h.className.split(/\s+/g).join(".")+"#"+h.id)}this.types=g.replace(/^\s+|\s+$/g,"").split(/\s+/g);this.options=f?JSON.parse(f):{};this.media=h.getAttribute("data-module-media")}};d.Module.MetaData=a})(this);(function(){function f(){}f.prototype={factory:null,manager:null,moduleObserver:null,subModulesEnabled:true,constructor:f,destructor:function d(g){if(g&&this.factory){this.factory.destructor()}this.factory=this.manager=null},_createModuleClass:function b(g){return"module "+g.charAt(0).toLowerCase()+g.slice(1,g.length).replace(/(\.[A-Z])/g,function(i,h){return"-"+h.replace(/\./g,"").toLowerCase()}).replace(/Module$/,"").replace(/^\s+|\s+$/g,"")},createModule:function c(i,k,g){var h=this.factory.getInstance(k);var j=this._createModuleClass(k);i.className+=i.className?" "+j:j;h.setElement(i);h.setOptions(g);if(g.defaultModule){this.manager.setDefaultModule(h)}this.moduleObserver.onModuleCreated(h,i,k);if(this.subModulesEnabled&&!g.subModulesDisabled){this._createSubModules(h)}return h},createModules:function c(g,k,j){var h=[],i,k=k||function(){};g.forEach(function(m,n,l){i=this.createModule(m,n,l);h.push(i);k.call(j,i,m,n,l)},this);k=j=i=null;return h},_createSubModules:function a(l){var k=l.element.getElementsByTagName("*"),m=k.length,j=0,h,g;for(j;j<m;j++){h=k[j];g=h.getAttribute("data-module-property");if(g){this._createSubModuleProperty(l,g,h)}}},_createSubModuleProperty:function e(k,i,j){var g=new Module.MetaData(j),h;if(g.types.length>1){throw new Error("Sub module elements cannot have more than one type specified in data-modules")}h=this.createModule(j,g.types[0],g.options);h.init();if(k[i]===null){k[i]=h}else{if(k[i] instanceof Array){if(!k.hasOwnProperty(i)){k[i]=[]}k[i].push(h)}else{throw new Error("Cannot create sub module property '"+i+"'. Property is neither null nor an Array on the parent module.")}}this.manager.markModulesCreated(j,g);h=g=j=null}};Module.Provider=f})();var Foundry={version:"0.1.1"};Foundry.run=function(f){f=f||function(){};var c={application:{type:"Foundry.Application",singleton:true,properties:{container:"container",dispatcher:"eventDispatcher",frontController:"frontController",moduleManager:"moduleManager"}},frontController:{type:"Oxydizr.FrontController",singleton:true},eventDispatcher:{type:"Beacon.Dispatcher",singleton:true},objectFactory:{type:"Foundry.ModuleFactory",singleton:true,properties:{container:"container"}},moduleFactory:{type:"Module.Factory",singleton:true,properties:{objectFactory:"objectFactory"}},moduleProvider:{type:"Module.Provider",singleton:true,properties:{factory:"moduleFactory"}},moduleManager:{type:"Module.Manager",singleton:true,properties:{provider:"moduleProvider",moduleObserver:"moduleObserver"}},moduleObserver:{type:"Module.FrontControllerModuleObserver",properties:{frontController:"frontController"}},module:{template:true,properties:{elementStore:"elementStore",eventDispatcher:"eventDispatcher"}},elementStore:{type:"ElementStore"},merge:function(h){for(var g in h){if(h.hasOwnProperty(g)){this[g]=h[g]}}return this}};var b={autoInit:true},d=f(c,b)||document.documentElement,a=new Hypodermic.Container(c),e=a.resolve("application");if(b.autoInit){e.init(d,b)}else{e.setElement(d);e.setOptions(b)}return e};Foundry.Application=function(){this.options={eagerLoadModules:true,focusAnythingInDefaultModule:false,handleActionErrors:true,handleApplicationErrors:true,lazyLoadModules:false,subModulesDisabled:false}};Foundry.Application.prototype={dispatcher:null,document:null,element:null,errorHandler:null,eventsController:null,frontController:null,moduleManager:null,newModuleController:null,options:null,window:null,constructor:Foundry.Application,init:function(c,b){if(c){this.setElement(c)}if(b){this.setOptions(b)}this._initErrorHandling();try{this.frontController.init(this.element);this._initEventsController();this._initNewModuleController();this._initModuleManager();this.dispatcher.publish("application.ready",this)}catch(a){if(!this.errorHandler||!this.errorHandler.handleError(a)){throw a}}return this},_initErrorHandling:function(){if(this.options.handleApplicationErrors){this.errorHandler=this.errorHandler||new Foundry.ErrorHandler();this.errorHandler.init(this,this.window);if(!this.frontController.errorHandler&&this.options.handleActionErrors){this.frontController.errorHandler=this.errorHandler}}},_initEventsController:function(){this.eventsController=this.eventsController||new Foundry.ApplicationEventsController(this.dispatcher);this.frontController.registerController(this.eventsController)},_initModuleManager:function(){this.moduleManager.init();if(this.options.eagerLoadModules){this.moduleManager.eagerLoadModules(this.element)}if(this.options.lazyLoadModules){this.moduleManager.lazyLoadModules(this.element)}this.moduleManager.focusDefaultModule(this.options.focusAnythingInDefaultModule)},_initNewModuleController:function(){var a=this.newModuleController||new Foundry.NewModuleController();a.dispatcher=this.dispatcher;a.document=this.document;a.frontController=this.frontController;a.moduleManager=this.moduleManager;a.init();this.newModuleController=a},destructor:function(){this.dispatcher.publish("application.destroy",this);this.moduleManager.destructor(true);this.errorHandler.destructor();this.eventsController.destructor();this.newModuleController.destructor();this.frontController.destructor();this.dispatcher.destructor();this.newModuleController=this.eventsController=this.dispatcher=this.frontController=this.moduleManager=this.errorHandler=this.element=this.document=this.window=this.logger=this.options=null},setElement:function(a){this.element=a;this.document=a.ownerDocument;this.window=this.document.defaultView},setOptions:function(a){for(var b in a){if(a.hasOwnProperty(b)){this.options[b]=a[b]}}}};Foundry.ApplicationEventsController=function(a){this.dispatcher=a};Foundry.ApplicationEventsController.prototype={controllerId:"events",dispatcher:null,frontController:null,constructor:Foundry.ApplicationEventsController,destructor:function(){if(this.frontController){this.frontController.unregisterController(this)}this.dispatcher=this.frontController=null},onControllerRegistered:function(b,a){this.frontController=b},onControllerUnregistered:function(a){},publishEvent:function click(b,a,c){if(!c.event){throw new Error("Missing required argument params.event")}b.stop();this.dispatcher.publish(c.event,a,c.data||{})}};Foundry.ErrorHandler=function(){};Foundry.ErrorHandler.prototype={application:null,logger:window.console||null,window:null,constructor:Foundry.ErrorHandler,destructor:function(){if(this.window){this.window.onerror=null}this.application=this.logger=this.window=null},init:function(a,b){this.application=a;this.window=b;this.window.onerror=this.handleError.bind(this)},_getErrorObject:function(errorMessage){var info=errorMessage.match(/^(([A-Za-z_][A-Za-z0-9._]*):)?(.+$)/),error=null,className,message,Klass;if(!info){error=new Error(message)}else{className=info[2]||"Error";message=(info[3]||errorMessage).replace(/^\s+|\s+$/g,"");if(/^[A-Za-z_][A-Za-z0-9._]*$/.test(className)){try{Klass=eval(className);error=new Klass(message)}catch(error){throw new Error("Class '"+className+"' is either not found or not an object constructor function")}}else{error=new Error(message)}}return error},handleActionError:function(b,d,c,g,f,a,e){if(this.logger){this.logger.error(b);this.logger.debug({error:b,event:d,element:c,params:g,action:f,controller:a,controllerId:e})}else{throw b}},handleError:function(b){var a=typeof b==="string"?this._getErrorObject(b):b;return this._handleError(a)},_handleError:function(a){if(this.logger){this.logger.error(a);return true}return false}};Foundry.ModuleFactory=function ModuleFactory(){};Foundry.ModuleFactory.prototype={container:null,constructor:Foundry.ModuleFactory,destructor:function(){this.container=null},getInstance:function(a){return this.container.resolve(a)}};Foundry.ModuleObserver=function(a){this.frontController=a||null};Foundry.ModuleObserver.prototype={frontController:null,constructor:Foundry.ModuleObserver,destructor:function(){this.frontController=null},onModuleCreated:function(b,a,c){b.controllerId=b.options.controllerId||b.guid},onModuleRegistered:function(a,b){this.frontController.registerController(a)},onModuleUnregistered:function(a){this.frontController.unregisterController(a)}};Foundry.NewModuleController=function(){};Foundry.NewModuleController.prototype={controllerId:"newModules",dispatcher:null,document:null,frontController:null,moduleManager:null,constructor:Foundry.NewModuleController,destructor:function(){if(this.dispatcher){this.dispatcher.unsubscribe(this)}if(this.frontController){this.frontController.unregisterController(this)}this.dispatcher=this.document=this.moduleManager=this.frontController=null},init:function(){this.dispatcher.subscribe(this.controllerId+".createModule",this,"handleCreateModule");this.frontController.registerController(this)},createModule:function click(b,a,c){b.stop();this._createModuleFromConfig(c);b=a=c=null},_createModuleFromConfig:function(c){if(!c.module){throw new Error("Missing required config.module")}else{if(!c.module.type){throw new Error("Missing required config.module.type")}else{if(!c.module.template){throw new Error("Missing required config.module.template for type: "+c.module.type)}}}c.module.options=c.module.options||{};c.container=c.container||{};c.container.insert=c.container.insert||"top";c.element=c.element||{};c.element.tag=c.element.tag||"div";var e=null;var b=null;var a="script[data-template="+c.module.template+"]";var f=this.document.querySelector(a);var d=this.document.createElement(c.element.tag);if(!f){throw new Error("Failed to find new module template using selector: "+a)}if(c.container.selector){b=this.document.querySelector(c.container.selector)}else{b=this.document.getElementsByTagName("body")[0]}if(!b){throw new Error("Failed to find module container with selector: "+(c.container.selector||"body"))}e=this.moduleManager.createModule(d,c.module.type,c.module.options||{});this.moduleManager.initModuleInContainer(d,b,c.container,f,c.module.type,e);e.focus();d=f=c=b=null;return e},handleCreateModule:function(a){this._createModuleFromConfig(a.data);return false},onControllerRegistered:function(b,a){},onControllerUnregistered:function(a){}};