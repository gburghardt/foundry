/*! foundry 2013-12-30 */
function Callbacks(a,b){a&&(this.context=a,this.types=b||{})}function ElementStore(){}function Hash(a){a&&this.merge(a)}function Reaper(){}window.Modernizr=function(a,b,c){function d(a){t.cssText=a}function e(a,b){return d(x.join(a+";")+(b||""))}function f(a,b){return typeof a===b}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){for(var d in a){var e=a[d];if(!g(e,"-")&&t[e]!==c)return"pfx"==b?e:!0}return!1}function i(a,b,d){for(var e in a){var g=b[a[e]];if(g!==c)return d===!1?a[e]:f(g,"function")?g.bind(d||b):g}return!1}function j(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+z.join(d+" ")+d).split(" ");return f(b,"string")||f(b,"undefined")?h(e,b):(e=(a+" "+A.join(d+" ")+d).split(" "),i(e,b,c))}function k(){o.input=function(c){for(var d=0,e=c.length;e>d;d++)E[c[d]]=!!(c[d]in u);return E.list&&(E.list=!(!b.createElement("datalist")||!a.HTMLDataListElement)),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),o.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)u.setAttribute("type",e=a[g]),d="text"!==u.type,d&&(u.value=v,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==c?(q.appendChild(u),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,q.removeChild(u)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?u.checkValidity&&u.checkValidity()===!1:u.value!=v)),D[a[g]]=!!d;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var l,m,n="2.7.1",o={},p=!0,q=b.documentElement,r="modernizr",s=b.createElement(r),t=s.style,u=b.createElement("input"),v=":)",w={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),y="Webkit Moz O ms",z=y.split(" "),A=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},C={},D={},E={},F=[],G=F.slice,H=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:r+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',r,'">',a,"</style>"].join(""),j.id=r,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=q.style.overflow,q.style.overflow="hidden",q.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),q.style.overflow=i),!!g},I=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b).matches;var d;return H("@media "+b+" { #"+r+" { position: absolute; } }",function(b){d="absolute"==(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position}),d},J=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var g=a in e;return g||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),g=f(e[a],"function"),f(e[a],"undefined")||(e[a]=c),e.removeAttribute(a))),e=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),K={}.hasOwnProperty;m=f(K,"undefined")||f(K.call,"undefined")?function(a,b){return b in a&&f(a.constructor.prototype[b],"undefined")}:function(a,b){return K.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=G.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(G.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(G.call(arguments)))};return d}),C.flexbox=function(){return j("flexWrap")},C.flexboxlegacy=function(){return j("boxDirection")},C.canvas=function(){var a=b.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},C.canvastext=function(){return!(!o.canvas||!f(b.createElement("canvas").getContext("2d").fillText,"function"))},C.webgl=function(){return!!a.WebGLRenderingContext},C.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:H(["@media (",x.join("touch-enabled),("),r,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!a.postMessage},C.websqldatabase=function(){return!!a.openDatabase},C.indexedDB=function(){return!!j("indexedDB",a)},C.hashchange=function(){return J("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},C.history=function(){return!(!a.history||!history.pushState)},C.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},C.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},C.rgba=function(){return d("background-color:rgba(150,255,150,.5)"),g(t.backgroundColor,"rgba")},C.hsla=function(){return d("background-color:hsla(120,40%,100%,.5)"),g(t.backgroundColor,"rgba")||g(t.backgroundColor,"hsla")},C.multiplebgs=function(){return d("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(t.background)},C.backgroundsize=function(){return j("backgroundSize")},C.borderimage=function(){return j("borderImage")},C.borderradius=function(){return j("borderRadius")},C.boxshadow=function(){return j("boxShadow")},C.textshadow=function(){return""===b.createElement("div").style.textShadow},C.opacity=function(){return e("opacity:.55"),/^0.55$/.test(t.opacity)},C.cssanimations=function(){return j("animationName")},C.csscolumns=function(){return j("columnCount")},C.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return d((a+"-webkit- ".split(" ").join(b+a)+x.join(c+a)).slice(0,-a.length)),g(t.backgroundImage,"gradient")},C.cssreflections=function(){return j("boxReflect")},C.csstransforms=function(){return!!j("transform")},C.csstransforms3d=function(){var a=!!j("perspective");return a&&"webkitPerspective"in q.style&&H("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},C.csstransitions=function(){return j("transition")},C.fontface=function(){var a;return H('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},C.generatedcontent=function(){var a;return H(["#",r,"{font:0/0 a}#",r,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},C.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},C.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},C.localstorage=function(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(a){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(r,r),sessionStorage.removeItem(r),!0}catch(a){return!1}},C.webworkers=function(){return!!a.Worker},C.applicationcache=function(){return!!a.applicationCache},C.svg=function(){return!!b.createElementNS&&!!b.createElementNS(B.svg,"svg").createSVGRect},C.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==B.svg},C.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(w.call(b.createElementNS(B.svg,"animate")))},C.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(w.call(b.createElementNS(B.svg,"clipPath")))};for(var L in C)m(C,L)&&(l=L.toLowerCase(),o[l]=C[L](),F.push((o[l]?"":"no-")+l));return o.input||k(),o.addTest=function(a,b){if("object"==typeof a)for(var d in a)m(a,d)&&o.addTest(d,a[d]);else{if(a=a.toLowerCase(),o[a]!==c)return o;b="function"==typeof b?b():b,"undefined"!=typeof p&&p&&(q.className+=" "+(b?"":"no-")+a),o[a]=b}return o},d(""),s=u=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=s.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=r[a[p]];return b||(b={},q++,a[p]=q,r[q]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():o.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),!f.canHaveChildren||n.test(a)||f.tagUrn?f:d.frag.appendChild(f)}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function i(a){a||(a=b);var d=e(a);return!s.shivCSS||j||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||h(a,d),a}var j,k,l="3.7.0",m=a.html5||{},n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,o=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",q=0,r={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var s={elements:m.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:l,shivCSS:m.shivCSS!==!1,supportsUnknownElements:k,shivMethods:m.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=s,i(b)}(this,b),o._version=n,o._prefixes=x,o._domPrefixes=A,o._cssomPrefixes=z,o.mq=I,o.hasEvent=J,o.testProp=function(a){return h([a])},o.testAllProps=j,o.testStyles=H,o.prefixed=function(a,b,c){return b?j(a,b,c):j(a,"pfx")},q.className=q.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+F.join(" "):""),o}(this,this.document),function(){function a(a){var b;if(a.self)for(b in a.self)a.self.hasOwnProperty(b)&&!this[b]&&(this[b]=a.self[b]);if(a.prototype)for(b in a.prototype)a.prototype.hasOwnProperty(b)&&!this.prototype[b]&&(this.prototype[b]=a.prototype[b]);if(a.includes){a.includes=a.includes instanceof Array?a.includes:[a.includes];for(var c=0,d=a.includes.length;d>c;c++)this.include(a.includes[c])}a.included&&a.included(this),a=null}function b(a){a=a||{};var b,d,e,f;f=c?function(){this.__proto__=f.prototype,f.__inheriting||this.initialize.apply(this,arguments)}:function(){f.__inheriting||this.initialize.apply(this,arguments)},f.__inheriting=!1;for(b in this)this.hasOwnProperty(b)&&(f[b]=this[b]);if(a.self)for(b in a.self)a.self.hasOwnProperty(b)&&(f[b]=a.self[b]);try{this.__inheriting=!0,f.prototype=new this,this.__inheriting=!1}catch(g){throw this.__inheriting=!1,g}if(c&&(f.prototype.__proto__=this.prototype),a.prototype)for(b in a.prototype)a.prototype.hasOwnProperty(b)&&(f.prototype[b]=a.prototype[b]);if(a.includes)for(a.includes=a.includes instanceof Array?a.includes:[a.includes],d=0,e=a.includes.length;e>d;d++)f.include(a.includes[d]);return f.prototype.initialize=f.prototype.initialize||function(){},f.prototype.constructor=f,a=null,f}var c=/msie/i.test(navigator.userAgent);Function.prototype.include||(Function.prototype.include=a),Function.prototype.extend||(Object.extend&&(Object._extend=b),Function.prototype.extend=b)}();var Cerealizer={_instances:{},objectFactory:null,_types:{},getInstance:function(a){if(this._types[a]){if(!this._instances[a]){var b;if(this.objectFactory){if(b=this.objectFactory.getInstance(a),!b)throw new Error("Could not get serializer instance from object factory for type: "+a)}else b=new this._types[a];this._instances[a]=b}return this._instances[a]}throw new Error("Cannot get instance for unregistered type: "+a)},registerType:function(a,b){for(var c=0,d=b.length;d>c;c++)this._types[b[c]]=a}};if(Cerealizer.Json=function(){},Cerealizer.Json.prototype={constructor:Cerealizer.Json,regex:/^[{\[]].*[}\]]$/g,deserialize:function(a){return JSON.parse(a)},serialize:function(a){return JSON.stringify(a)},test:function(a){return this.regex.test(a)},toString:function(){return"[object Cerealizer.Json]"}},!window.JSON)throw new Error("No native JSON parser was found. Consider using JSON2.js (https://github.com/douglascrockford/JSON-js)");if(Cerealizer.registerType(Cerealizer.Json,["json","text/json","application/json"]),Cerealizer.QueryString=function(){},Cerealizer.QueryString.prototype={constructor:Cerealizer.QueryString,hashNotation:!0,keysRegex:/[\[\].]+/,pairsRegex:/([^=&]+)=([^&]+)/g,regex:/([^=&]+)=([^&]+)/,_convert:function(a){return a="string"==typeof a?unescape(a):a,/^[-+0-9.]+$/.test(a)&&!isNaN(a)?Number(a):/^(true|false)$/.test(a)?"true"===a:"NaN"===a?0/0:a},_convertAndHydrate:function(a,b,c){c=this._convert(unescape(c)),this._isValid(c)&&(keys=b.replace(/]$/,"").split(this.keysRegex),this._hydrate(a,keys,c))},deserialize:function(a){var b=this,c={};return a.replace(/^\?/,"").replace(this.pairsRegex,function(a,d,e){if(/\[\]/.test(d))throw new Error("Cannot deserialize keys with empty array notation: "+d);b._convertAndHydrate(c,d,e)}),c},_hydrate:function(a,b,c){var d,e=a,f=0,g=b.length-1,h=unescape(b[b.length-1]);for(f;g>f;f++)d=unescape(b[f]),e.hasOwnProperty(d)||(e[d]={}),e=e[d];return e[h]=c,e=b=null,a},_isValid:function(a){if(null===a||void 0===a)return!1;var b=typeof a;return"number"===b?!isNaN(a):"string"===b||"boolean"===b?!0:!1},_isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},serialize:function(a){var b=this.hashNotation?"[":".",c=this.hashNotation?"]":"",d="[",e="]",f=[];return this._serialize(a,f,"",b,c,d,e).join("&")},_serialize:function(a,b,c,d,e,f,g){var h,i,j,k=/^[0-9+]$/;for(var l in a)a.hasOwnProperty(l)&&(this._isObject(a[l])?(h=c?k.test(l)?c+f+l+g:c+d+l+e:l,this._serialize(a[l],b,h,d,e,f,g)):this._isValid(a[l])&&(i=c?k.test(l)?c+f+escape(l)+g:c+d+escape(l)+e:escape(l),j=escape(a[l]),b.push(i+"="+j)));return b},test:function(a){return this.regex.test(a)},toString:function(){return"[object Cerealizer.QueryString]"}},Cerealizer.registerType(Cerealizer.QueryString,["queryString","application/x-www-form-urlencoded","multipart/form-data"]),Cerealizer.Xml=function(){this.parser=this.constructor.getParser()},Cerealizer.Xml.getParser=function(){return window.DOMParser?new DOMParser:null},Cerealizer.Xml.prototype={constructor:Cerealizer.Xml,parser:null,regex:/^\s*<[a-zA-Z][a-zA-Z0-9:]*.*?<\/[a-zA-Z0-9:]+[a-zA-Z]>\s*$/,_deserializeMSIE:function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async=!1,b.loadXML(a),b},_deserializeStandard:function(a){return this.parser.parseFromString(a,"text/xml")},_escape:function(a){return String(a).replace(/\&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},serialize:function(a){var b=this._serialize(a,[]);return b.join("")},_serialize:function(a,b){for(var c in a)a.hasOwnProperty(c)&&(this._isObject(a[c])?(b.push("<"+c+">"),this._serialize(a[c],b),b.push("</"+c+">")):b.push("<"+c+">"+this._escape(a[c])+"</"+c+">"));return b},test:function(a){return this.regex.test(a)},toString:function(){return"[object Cerealizer.Xml]"}},window.DOMParser)Cerealizer.Xml.prototype.deserialize=Cerealizer.Xml.prototype._deserializeStandard;else{if(!window.ActiveXObject)throw new Error("No native XML parser could be found.");Cerealizer.Xml.prototype.deserialize=Cerealizer.Xml.prototype._deserializeMSIE}Cerealizer.registerType(Cerealizer.Xml,["xml","text/xml","application/xml"]),Callbacks.prototype={context:null,types:null,destructor:function(){this.context=this.types=null},add:function(a,b){return this.types[a]||(this.types[a]=[]),this.types[a].push(b),this},execute:function(a){if(!this.types[a])return!0;var b,c=Array.prototype.slice.call(arguments,1,arguments.length),d=0,e=this.types[a].length,f=!0;for(d;e>d;d++){if(b=this.types[a][d],!this.context[b])throw new Error("No callback method found: "+b);if(this.context[b].apply(this.context,c)===!1){f=!1;break}}return f},remove:function(a,b){if(this.types[a]){var c=0,d=this.types[a].length;for(c;d>c;c++)if(b===this.types[a][c]){this.types[a].splice(c,1);break}return this}}},Callbacks.Utils={self:{addCallback:function(a,b){this.prototype.callbacks[a]?!this.prototype.callbacks[a]instanceof Array&&(this.prototype.callbacks[a]=[this.prototype.callbacks[a]]):this.prototype.callbacks[a]=[],this.prototype.callbacks[a].push(b)}},prototype:{callbacks:{},initCallbacks:function(a){this.hasOwnProperty("callbacks")||(this.callbacks=new Callbacks(this)),a&&(this.callbacks.types=a)},destroyCallbacks:function(){this.callbacks&&(this.callbacks.destructor(),this.callbacks=null)}}},dom=window.dom||{},dom.events=dom.events||{},dom.events.Delegator=function(){function a(a,b){var c=a.getAttribute("data-actionparams-"+b)||a.getAttribute("data-actionparams");return a=null,c?JSON.parse(c):{}}function b(){return k.node.ownerDocument}function c(a){return k.actionPrefix?a.replace(/.+?(\w+)$/g,"$1"):a}function d(a,b){var c=b;return k.actionPrefix?(c=b,k.actionPrefix+c!==a?c=null:!k.delegate[c]&&k.delegate.handleAction&&(c="handleAction")):!k.delegate[c]&&k.delegate.handleAction&&(c="handleAction"),c}function e(){this._stopPropagation(),this.propagationStopped=!0}function f(a){return a._stopPropagation||(a._stopPropagation=a.stopPropagation,a.stopPropagation=e,a.propagationStopped=!1,a.stop=function(){this.preventDefault(),this.stopPropagation()},a.actionTarget||(a.actionTarget=a.target||a.srcElement)),a}function g(a){a=f(a||window.event),i(a,a.actionTarget),a=null}function h(a){13===a.keyCode&&g(a),a=null}function i(b,e){var f,g=null,h=null,l=null;if(g=e.getAttribute("data-action-"+b.type)||e.getAttribute("data-action"),g&&(h=c(g),k.actionEventMapping&&k.actionEventMapping[h]!==b.type?h=null:l=d(g,h)),l&&k.delegate[l])try{f=a(e,b.type),k.delegate[l](b,e,f,h)}catch(m){b.preventDefault(),b.stopPropagation(),j(b,e,f,h,l,m)}!b.propagationStopped&&e!==k.node&&e.parentNode?(b.actionTarget=e.parentNode,i(b,b.actionTarget)):(b.actionTarget=null,b.stopPropagation=b._stopPropagation,b._stopPropagation=null,b.propagationStopped=null),b=e=null}function j(a,b,c,d,e,f){if(k.delegate.handleActionError)k.delegate.handleActionError(a,b,{error:f,params:c,method:e},d);else if(k.constructor.errorDelegate)k.constructor.errorDelegate.handleActionError(a,b,{error:f,params:c,method:e},d);else{if(!k.constructor.logger)throw f;k.constructor.logger.warn('An error was thrown while executing method "'+e+'", action "'+d+'", during a "'+a.type+'" event on element '+k.node.nodeName+"."+k.node.className.split(/\s+/g).join(".")+"#"+k.node.id+"."),k.constructor.logger.error(f)}}this.initialize=function(a,b,c){this.actionPrefix=null,this.eventTypes=[],this.eventTypesAdded={},this.eventActionMapping=null,this.actionEventMapping=null,this.delegate=a||null,this.node=b||null,c&&this.setActionPrefix(c)},this.destructor=function(){this.node&&(this.removeEventTypes(this.eventTypes),this.node=null),this.delegate=k=null},this.init=function(){return"string"==typeof this.node&&(this.node=document.getElementById(this.node)),this},this.addEventListener||(this.addEventListener=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}),this.addEventType=function(a){this.eventTypesAdded[a]||("enterpress"===a?this.addEventListener(this.node,"keypress",h):this.addEventListener(this.node,a,g),this.eventTypes.push(a),this.eventTypesAdded[a]=!0)},this.addEventTypes=function(a){var b=0,c=a.length;for(b;c>b;++b)this.addEventType(a[b])},this.removeEventListener||(this.removeEventListener=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)}),this.removeEventType=function(a){this.eventTypesAdded[a]&&("enterpress"===a?this.removeEventListener(this.node,"keypress",h):this.removeEventListener(this.node,a,g),this.eventTypesAdded[a]=!1)},this.removeEventTypes=function(a){var b=0,c=a.length;for(b;c>b;++b)this.removeEventType(a[b])},this.setActionPrefix=function(a){a.match(/\.$/)||(a+="."),this.actionPrefix=a},this.setEventActionMapping=function(a){var b,c,d;if(this.eventActionMapping)for(b in this.eventActionMapping)this.eventActionMapping.hasOwnProperty(b)&&this.removeEventType(b);this.actionEventMapping={};for(b in a)if(a.hasOwnProperty(b))for(this.addEventType(b),a[b]=a[b]instanceof Array?a[b]:[a[b]],c=0,d=a[b].length;d>c;c++)this.actionEventMapping[a[b][c]]=b;this.eventActionMapping=a,a=null},this.triggerEvent||(this.triggerEvent=function(a){var c=b().createEvent("CustomEvent");c.initCustomEvent(a,!0,!1,null),this.node.dispatchEvent(c),c=null});var k=this;this.node=null,this.eventTypes=null,this.eventTypesAdded=null,this.delegate=null,this.constructor=dom.events.Delegator,this.getActionParams=a,this.getMethodFromAction=d,this.handleActionError=j,this.handleEvent=g,this.handlePatchedEvent=i,this.initialize.apply(this,arguments)},dom.events.Delegator.logger=window.console||null,dom.events.Delegator.errorDelegate=null,ElementStore.prototype={_cache:null,config:null,_document:null,_root:null,constructor:ElementStore,init:function(a){if(!a)throw new Error("Missing required argument: root");return this.config=this.config||{elements:{},collections:{}},this._cache={},this.setRoot(a),this.createElement||(this.createElement=this._createElement),this.parseHTML||(this.parseHTML=this._parseHTML),this.querySelector||(this.querySelector=this._querySelector),this.querySelectorAll||(this.querySelectorAll=this._querySelectorAll),this.eagerLoad(),this},destructor:function(){this._cache&&(this.clearCache(),this._cache=null),this.config=this._root=this._document=null},clearCache:function(){var a;for(a in this._cache)this._cache.hasOwnProperty(a)&&(this._cache[a]=null);return this},_createElement:function(a){return this._document.createElement(a)},eagerLoad:function(){var a,b;for(a in this.config.elements)this.config.elements.hasOwnProperty(a)&&(b=this.config.elements[a],b.eager&&!b.nocache&&(this._cache[a]=this.getElement(a)));for(a in this.config.collections)this.config.collections.hasOwnProperty(a)&&(b=this.config.collections[a],b.eager&&!b.nocache&&this.getCollection(a));return this},get:function(a){return this.getElement(a)||this.getCollection(a)||null},getCollection:function(a){var b;if(this.config.collections[a])if(this._cache[a])b=this._cache[a];else{if(!this.config.collections[a].selector)throw new Error('Missing required config "selector" for collection '+a);b=this.querySelectorAll(this.config.collections[a].selector),this.config.collections[a].nocache||(this._cache[a]=b)}else b=null;return b},getElement:function(a){var b;if(this.config.elements[a])if(this._cache[a])b=this._cache[a];else{if(!this.config.elements[a].selector)throw new Error('Missing required config "selector" for element '+a);b=this.querySelector(this.config.elements[a].selector),this.config.elements[a].nocache||(this._cache[a]=b)}else b=null;return b},isCollection:function(a){return this.config.collections.hasOwnProperty(a)},isElement:function(a){return this.config.elements.hasOwnProperty(a)},keys:function a(){var b,a=[];for(b in this.config.elements)this.config.elements.hasOwnProperty(b)&&a.push(b);for(b in this.config.collections)this.config.collections.hasOwnProperty(b)&&a.push(b);return a},_mergeConfigs:function(a,b,c){for(key in b)!b.hasOwnProperty(key)||void 0!==a[key]&&c||(a[key]=b[key])},_parseHTML:function(a){a=a.replace(/^\s+|\s+$/g,"");var b=this.createElement("div");b.innerHTML=a;for(var c=[],d=b.childNodes.length;d--;)c.push(b.childNodes[d]),b.removeChild(b.childNodes[d]);return b=null,c},setConfig:function(a,b){return this.config=this.config||{elements:{},collections:{}},a.elements&&this._mergeConfigs(this.config.elements,a.elements,b),a.collections&&this._mergeConfigs(this.config.collections,a.collections,b),this},setRoot:function(a){return this.clearCache(),this._root=a,this._document="#document"===this._root.nodeName?this._root:this._root.ownerDocument,this},toString:function(){return"[object ElementStore]"},_querySelector:function(a,b){return(b||this._root).querySelector(a)},_querySelectorAll:function(a,b){return(b||this._root).querySelectorAll(a)}},ElementStore.Utils={prototype:{elementStore:{},destroyElementStore:function(){this.elementStore&&(this.elementStore.destructor(),this.elementStore=null)},initElementStore:function(a){this.hasOwnProperty("elementStore")||(this.elementStore=new ElementStore),this._compileElementStore(),this._initGetters(),this.elementStore.init(a)},_initGetters:function(){if(!this.__proto__.hasOwnProperty("__elementStoreGettersCreated__")){var a,b,c=this.__proto__,d=this.elementStore.config.elements,e=this.elementStore.config.collections;this.createElementGetter||(this.createElementGetter=this._createElementGetter),this.createCollectionGetter||(this.createCollectionGetter=this._createCollectionGetter);for(a in d)if(d.hasOwnProperty(a)){if(c[a]){if(c[a+"Element"])throw new Error("Cannot create element getter: "+a);b=a+"Element"}else b=a;this.createElementGetter(a,b)}for(a in e)if(e.hasOwnProperty(a)){if(c[a]){if(c[a+"Collection"])throw new Error("Cannot create collection getter: "+a);b=a+"Collection"}else b=a;this.createCollectionGetter(a,b)}c.__elementStoreGettersCreated__=!0,d=e=c=null}},clearElementStoreCache:function(){this.elementStore.clearCache()},collection:function(a){return this.elementStore.getCollection(a)},_compileElementStore:function(){if(this.__proto__.hasOwnProperty("_compiledElementStore"))return this.elementStore.setConfig(this.__proto__._compiledElementStore),void 0;for(var a=this.__proto__;a;)a.hasOwnProperty("elementStore")&&this.elementStore.setConfig(a.elementStore,!0),a=a.__proto__;this.__proto__._compiledElementStore=this.elementStore.config},_createCollectionGetter:function(a,b){var c=function(){return this.elementStore.getCollection(a)};this.__proto__[b]=c},_createElementGetter:function(a,b){var c=function(){return this.elementStore.getElement(a)};this.__proto__[b]=c},element:function(a){return this.elementStore.getElement(a)}}};var Events={};Events.Dispatcher=function(){this._subscribers={}},Events.Dispatcher.logger=window.console||null,Events.Dispatcher.prototype={_subscribers:null,constructor:Events.Dispatcher,destructor:function(){if(this._subscribers){var a,b,c,d,e=this._subscribers;for(b in e)if(e.hasOwnProperty(b)){for(c=0,d=e[b].length;d>c;c++)a=e[b][c],a.callback=a.context=null;e[b]=null}a=e=this._subscribers=null}},_dispatchEvent:function(a,b){for(var c,d=0,e=b.length;e>d&&(c=b[d],"function"===c.type?c.callback.call(c.context,a,a.publisher,a.data):"string"===c.type&&c.context[c.callback](a,a.publisher,a.data),!a.cancelled);d++);b=c=a=null},publish:function(a,b,c){if(!this._subscribers[a])return!0;var d=new Events.Event(a,b,c),e=this._subscribers[a],f=!1;return this._dispatchEvent(d,e),f=d.cancelled,d.destructor(),d=b=c=e=null,!f},subscribe:function(a,b,c){var d=typeof b,e=typeof c;if(this._subscribers[a]=this._subscribers[a]||[],"function"===d)this._subscribers[a].push({context:null,callback:b,type:"function"});else if("object"===d){if("string"===e&&"function"!=typeof b[c])throw new Error("Cannot subscribe to "+a+" because "+c+" is not a function");this._subscribers[a].push({context:b||null,callback:c,type:e})}},unsubscribe:function(a,b,c){if(this._subscribers[a]){var d,e=typeof b,f=typeof c,g=this._subscribers[a],h=g.length;for("function"===e?(c=b,b=null,f="function"):"object"===e&&"undefined"===f&&(f="any");h--;)d=g[h],("any"===f&&d.context===b||d.type===f&&d.context===b&&d.callback===c)&&g.splice(h,1)}b=c=g=d=null},unsubscribeAll:function(a){var b,c,d;for(b in this._subscribers)if(this._subscribers.hasOwnProperty(b))for(d=this._subscribers[b],c=d.length;c--;)d[c].context===a&&d.splice(c,1);a=d=null}},Events.ApplicationEvents={eventDispatcher:null,self:{getEventDispatcher:function(){return Events.ApplicationEvents.eventDispatcher||(Events.ApplicationEvents.eventDispatcher=new Events.Dispatcher),Events.ApplicationEvents.eventDispatcher},checkEventDispatcher:function(){if(!this.getEventDispatcher())throw new Error("No application event dispatcher was found. Please set Events.ApplicationEvents.eventDispatcher.");return!0},publish:function(a,b,c){return this.checkEventDispatcher(),this.getEventDispatcher().publish(a,b,c)},subscribe:function(a,b,c){this.checkEventDispatcher(),this.getEventDispatcher().subscribe(a,b,c)},unsubscribe:function(a,b,c){this.checkEventDispatcher(),this.getEventDispatcher().unsubscribe(a,b,c)}},prototype:{eventDispatcher:null,_initApplicationEvents:function(){this.hasOwnProperty("eventDispatcher")||(this.eventDispatcher=this.constructor.getEventDispatcher())},_destroyApplicationEvents:function(){this.eventDispatcher&&this.eventDispatcher.unsubscribe(this)},publish:function(a,b){return this.eventDispatcher.publish(a,this,b)},subscribe:function(a,b,c){return this.eventDispatcher.subscribe(a,b,c),this},unsubscribe:function(a,b,c){return this.eventDispatcher.unsubscribe(a,b,c),this}}},Events.Notifications={includes:Events.ApplicationEvents,guid:0,self:{addNotifications:function(a){var b,c=this.prototype.notifications||{};for(b in a)a.hasOwnProperty(b)&&(c[b]=c[b]?c[b]instanceof Array?c[b]:[c[b]]:[],c[b].push(a[b]));this.prototype.notifications=c,c=a=null}},prototype:{_notificationDispatcher:null,_notificationId:null,_notificationIdPrefix:"notifications",notifications:null,_initNotifications:function(){this.__proto__.hasOwnProperty("_compiledNotifications")||this._compileNotifications(),this._initApplicationEvents(),this._notificationId=Events.Notifications.guid++;var a,b,c,d;for(a in this._compiledNotifications)if(this._compiledNotifications.hasOwnProperty(a))for(d=this._compiledNotifications[a],b=0,c=d.length;c>b;b++)this.listen(a,this,d[b]);this._setUpNotifications()},_compileNotifications:function(){for(var a,b,c,d={},e=this.__proto__;e;){if(e.hasOwnProperty("notifications")&&e.notifications){c=e.notifications;for(a in c)if(c.hasOwnProperty(a))for(d[a]=d[a]||[],c[a]=c[a]instanceof Array?c[a]:[c[a]],b=c[a].length;b--;)d[a].unshift(c[a][b])}e=e.__proto__}this.__proto__._compiledNotifications=d,e=c=d=null},_destroyNotifications:function(){this._notificationDispatcher&&(this._notificationDispatcher.destructor(),this._notificationDispatcher=null)},_setUpNotifications:function(){},notify:function(a,b){var c=this.publish(this._notificationIdPrefix+"."+this._notificationId+"."+a,b);return b=null,c},listen:function(a,b,c){return this.subscribe(this._notificationIdPrefix+"."+this._notificationId+"."+a,b,c),b=c=null,this},ignore:function(a,b,c){return this.unsubscribe(this._notificationIdPrefix+"."+this._notificationId+"."+a,b,c),b=c=null,this
}}},Hash.prototype={constructor:Hash,destructor:function(){for(var a in this)this.exists(a)&&(this[a]=null)},empty:function(){var a,b=this.keys(),c=0,d=b.length;for(c;d>c;c++)a=b[c],this[a]=null,delete this[a];return this},exists:function(a){return!this.isReserved(a)&&this.hasOwnProperty(a)?!0:!1},filter:function(a,b){b=b||this;var c=new Hash;for(var d in this)this.exists(d)&&a.call(b,d,this[d])&&c.set(d,this[d]);return c},forEach:function(a,b){b=b||this;for(var c in this)if(this.exists(c)&&a.call(b,c,this[c])===!1)break;return a=b=null,this},get:function(a){if(this.isReserved(a))throw new Error("Cannot get reserved property: "+a);return this.hasOwnProperty(a)?this[a]:null},isEmpty:function(){return 0===this.size()},isReserved:function(a){return this.constructor.prototype.hasOwnProperty(a)},keys:function b(){var b=[];for(var a in this)this.exists(a)&&b.push(a);return b},merge:function(a,b){if(!a)throw new Error("Missing required argument: overrides");var c,d,e,f,g;for(c in a)if(a.hasOwnProperty(c))if(e=this[c],d=a[c])if(d.constructor===Array&&e&&e.constructor===Array&&!this.isReserved(c))for(f=0,g=d.length;g>f;f++)e.push(d[f]);else e&&e.constructor===Hash&&!this.isReserved(c)?e.merge(d):this.exists(c)&&b||this.set(c,a[c]);else this.exists(c)&&b||this.set(c,d);return this},safeMerge:function(a){this.merge(a,!0)},set:function(a,b){if(this.isReserved(a))throw new Error("Cannot set reserved property: "+a);return this[a]=b,this},size:function(){return this.keys().length},toString:function(){return"[object Hash]"}},Reaper.prototype={allowNulls:!1,flat:!0,nestedKeysRegex:/[.\[\]]+/g,constructor:Reaper,_extractFieldValues:function(a,b){var c,d,e=0,f=a.length;for(e;f>e;e++)c=this._extractValue(a[e]),d=a[e].name,this._setValue(b,d,c)},_extractValue:function(a){var b,c,d=a.nodeName.toLowerCase(),e=null;if(!a.disabled)if("input"===d)"checkbox"===a.type||"radio"===a.type?a.checked&&(e=a.value):e=a.value;else if("select"===d)if(a.multiple)for(e=[],b=0,c=a.options.length;c>b;++b)!a.options[b].disabled&&a.options[b].selected&&a.options[b].value&&e.push(a.options[b].value);else e=a.value;else e=a.value;return a=null,""===e?null:e},getData:function(a,b){if(!a)throw new Error("Missing required argument: element");b=b||{};var c=a.getElementsByTagName("input"),d=a.getElementsByTagName("select"),e=a.getElementsByTagName("textarea");return this._extractFieldValues(c,b),this._extractFieldValues(d,b),this._extractFieldValues(e,b),a=c=d=e=null,b},_setNestedValue:function(a,b,c){var d,e=a,f=0,g=b.length-1,h=b[g];for(f;g>f;f++)d=b[f],e.hasOwnProperty(d)||(e[d]={}),e=e[d];e[h]=c,e=b=null},_setValue:function(a,b,c){if(this.flat)(null!==c||this.allowNulls)&&(a[b]=c);else if(null!==c||this.allowNulls){var d=b.replace(/\]$/,"").split(this.nestedKeysRegex);this._setNestedValue(a,d,c)}}},function(a){var b=0,c=Object.extend({includes:[Callbacks.Utils,Events.Notifications,ElementStore.Utils],self:{manager:null,getManager:function(){return c.manager},unregister:function(a){c.manager&&c.manager.unregisterModule(a)}},prototype:{actions:{click:["cancel"]},callbacks:{afterReady:["_loaded"]},delegator:null,document:null,element:null,elementStore:{},guid:null,options:{actionPrefix:null,defaultModule:!1},window:null,initialize:function(){this.guid=b++},init:function(a,b){if(this.element="string"==typeof a?document.getElementById(a):a,!this.element)throw new Error("Could not find element: "+a);return this.document=this.element.ownerDocument,this.window=this.document.defaultView||this.document.parentWindow,this.hasOwnProperty("options")||(this.options=new Hash),this._initOptions(this.options),b&&this.options.merge(b),this.delegator||(this.delegator=new dom.events.Delegator),this.delegator.delegate=this,this.delegator.node=this.element,this.options.actionPrefix&&this.delegator.setActionPrefix(this.options.actionPrefix),this.delegator.init(),this._initActions(),this._initCallbacks(),this._initNotifications(),this.initElementStore(this.element),this.callbacks.execute("beforeReady"),this._ready(),this.callbacks.execute("afterReady"),this.options.defaultModule&&this.constructor.getManager().setDefaultModule(this),this},destructor:function(a){this.callbacks.execute("beforeDestroy"),this.constructor.unregister(this),this.destroyElementStore(),this.destroyCallbacks(),this.delegator&&this.delegator.destructor(),!a&&this.element&&this.element.parentNode.removeChild(this.element),this.options&&this.options.destructor(),this.actions=this.element=this.delegator=this.options=this.document=this.window=null},cancel:function(a,b,c){a.stop(),this.destructor(),a=b=c=null},focus:function(a){var b,c=this.element.getElementsByTagName("*"),d=0,e=c.length;if(a){for(d;e>d;d++)if(b=c[d],"A"===b.tagName||"BUTTON"===b.tagName||"TEXTAREA"===b.tagName||"SELECT"===b.tagName||"INPUT"===b.tagName&&"hidden"!==b.type){b.focus&&b.focus(),b.select&&b.select();break}}else for(d;e>d;d++)if(b=c[d],"TEXTAREA"===b.tagName||"SELECT"===b.tagName||"INPUT"===b.tagName&&"hidden"!==b.type){b.focus&&b.focus(),b.select&&b.select();break}},_ready:function(){},_initActions:function(){for(var a=new Hash,b=this.__proto__;b;)b.hasOwnProperty("actions")&&a.safeMerge(b.actions),b=b.__proto__;this.delegator.setEventActionMapping(a)},_initCallbacks:function(){for(var a=new Hash,b=this.__proto__;b;)b.hasOwnProperty("callbacks")&&a.safeMerge(b.callbacks),b=b.__proto__;this.initCallbacks(a)},_initOptions:function(){for(var a=this.__proto__;a;)a.hasOwnProperty("options")&&this.options.safeMerge(a.options),a=a.__proto__},_loading:function(a){a=a||this.element,a.className+=" loading",a=null},_loaded:function(a){a=a||this.element,a.className=a.className.replace(/(^|\s+)(loading)(\s+|$)/,"$1$3").replace(/[\s]{2,}/g," "),a=null},setOptions:function(a){this.hasOwnProperty("options")?this.options.merge(a):this.options=new Hash(a)}}});a.Module=c}(window),Module.FormModule=Module.extend({prototype:{actions:{enterpress:["submit"],submit:["submit"]},callbacks:{beforeReady:["initExtractor","initSerializerFactory"]},extractor:null,options:{"extractor.allowNulls":!1,"extractor.flat":!1},serializerFactory:null,initExtractor:function(){this.extractor=this.extractor||new Reaper,this.extractor.allowNulls=this.options["extractor.allowNulls"],this.extractor.flat=this.options["extractor.flat"]},initSerializerFactory:function(){this.serializerFactory=this.serializerFactory||Cerealizer},_afterSubmit:function(a){a=null},_beforeSubmit:function(a,b,c,d){return a=b=c=d=null,!0},_getData:function(){return this.extractor.getData(this.element)},_getTransport:function(){return new XMLHttpRequest},_sendRequest:function(a){var b=this._getTransport(),c=this.element.getElementsByTagName("form")[0]||this.element,d=(c.getAttribute("method")||c.getAttribute("data-form-method")||"POST").toUpperCase(),e=c.getAttribute("action")||c.getAttribute("data-form-action"),f=c.getAttribute("enctype")||c.getAttribute("data-form-enctype")||"queryString",g=this,h=this.serializerFactory.getInstance(f),i=h.serialize(a);if(!e)throw new Error("Missing required attribute: action or data-form-action");var j=function(){4===this.readyState&&(this.status<300||this.status>399)&&(g.element.innerHTML=this.responseText,k())},k=function(){g._loaded(),g._afterSubmit(b),g=a=event=element=i=b=b.onreadystatechange=c=null};"GET"===d&&(e+=/\?/.test(e)?i:"?"+i,i=null),b.open(d,e,!0),b.setRequestHeader("X-Requested-With","XMLHttpRequest"),f&&b.setRequestHeader("Content-Type",f),this._loading(),b.onreadystatechange=j,b.send(i)},submit:function(a,b,c){a.stop();var d=this._getData();this._beforeSubmit(d,a,b,c)&&this._sendRequest(d)}}}),Module=window.Module||{},Module.Factory=function(){},Module.Factory.prototype={objectFactory:null,constructor:Module.Factory,destructor:function(){this.objectFactory=null},createInstance:function(a,b,c){var d=this.getInstance(b);return d.init(a,c),d},getInstance:function getInstance(type){var instance=null,Klass=null;if(this.objectFactory){if(instance=this.objectFactory.getInstance(type),!instance)throw new Error("The object factory failed to get a new instance for type: "+type)}else{if(!/^[a-zA-Z][a-zA-Z0-9.]+[a-zA-Z0-9]$/.test(type))throw new Error("Cannot instantiate invalid type: "+type);try{Klass=eval(type)}catch(error){throw new Error("Class name "+type+" does not exist")}if(!Klass)throw new Error("Class name "+type+" does not exist");if("function"!=typeof Klass)throw new Error("Class name "+type+" is not a constructor function");instance=new Klass}return instance}},window.Module=window.Module||{},Module.Manager=function(){},Module.Manager.prototype={baseClassName:"module",defaultModule:null,defaultModuleFocused:!1,factory:null,registry:null,groups:null,constructor:Module.Manager,destructor:function(a){Module.manager===this&&(Module.manager=null),this.registry&&this._destroyRegistry(a),this.groups&&this._destroyGroups(),this.factory&&(a&&this.factory.destructor(),this.factory=null)},_destroyGroups:function(){var a,b,c,d;for(a in this.groups)if(this.groups.hasOwnProperty(a)){for(b=this.groups[a],c=0,d=b.length;d>c;c++)b[c]=null;this.groups[a]=null}this.groups=null},_destroyRegistry:function(a){var b,c;for(b in this.registry)this.registry.hasOwnProperty(b)&&(c=this.registry[b],a&&c.module.destructor(!0),c.module=null,this.registry[b]=null);this.registry=null},init:function(){return this.factory=this.hasOwnProperty("factory")?this.factory:new Module.Factory,this.registry=this.hasOwnProperty("registry")?this.registry:{},this.groups=this.hasOwnProperty("groups")?this.groups:{},Module.manager=this,this},eagerLoadModules:function(a){var b=a.getElementsByTagName("*"),c=0,d=b.length;for(c;d>c;c++)b[c].getAttribute("data-modules")&&this.createModules(b[c]);return b=null,this},createModule:function(a,b,c,d){var e=a.className+" module "+b.charAt(0).toLowerCase()+b.slice(1,b.length).replace(/([.A-Z]+)/g,function(a,b){return"-"+b.replace(/\./g,"").toLowerCase()});a.className=e.replace(/^\s+|\s+$/g,"");var f=this.factory.getInstance(b);return f.setOptions(c),d&&this.registerModule(b,f),a=c=null,f},createModules:function(a){if(!a)throw new Error("Missing required argument: element");var b=this.getModuleMetaData(a);if(1===b.types.length)module=this.createModule(a,b.types[0],b.options,!0),module.init(a,b.options);else for(i=0,length=b.types.length;length>i;i++)type=b.types[i],opts=b.options[type]||{},module=this.createModule(a,type,opts,!0),module.init(a,opts);this.markModulesCreated(a,b),b=a=module=opts=options=null},focusDefaultModule:function(a){this.defaultModule&&!this.defaultModuleFocused&&(this.defaultModuleFocused=!0,this.defaultModule.focus(a))},getModuleMetaData:function(a){var b,c=a.getAttribute("data-modules"),d=a.getAttribute("data-module-options"),e={element:a,types:null,options:null};if(!c)throw new Error("Missing required attribute data-modules on "+a.nodeName+"."+a.className.split(/\s+/g).join(".")+"#"+a.id);return c=c.replace(/^\s+|\s+$/g,"").split(/\s+/g),b=c.length,d=d?JSON.parse(d):{},e.types=c,e.options=d,a=null,e},initModuleInContainer:function(a,b,c,d,e,f){var g=new Date,h=new Hash({guid:f.guid,createdAt:g,timestamp:g.getTime()});c.renderData&&h.merge(c.renderData);var i=d.innerHTML.replace(/#\{([-.\w]+)\}/g,function(a,b){return h[b]||""});a.className+=(" "+this.baseClassName+" "+c.className).replace(/\s{2,}/g," "),a.innerHTML=i,"top"===c.insert&&b.firstChild?b.insertBefore(a,b.firstChild):b.appendChild(a),f.init(a),this.registerModule(e,f)},markModulesCreated:function(a,b){a.setAttribute("data-modules-created",b.types.join(" ")),a.removeAttribute("data-modules"),a=b=null},registerModule:function(a,b){if(void 0===b.guid||null===b.guid)throw new Error("Cannot register module "+a+" without a guid property");if(this.registry[b.guid])throw new Error("Module "+b.guid+" has already been registered");this.registry[b.guid]={module:b,type:a},this.groups[a]||(this.groups[a]=[]),this.groups[a].push(b),b=null},unregisterModule:function(a){if(!a.guid||!this.registry[a.guid])return a=null,void 0;var b=a.guid,c=this.registry[b].type,d=this.groups[c];if(this.registry[b].module=null,this.registry[b]=null,delete this.registry[b],d)for(var e=0,f=d.length;f>e;e++)if(d[e]===a){d.splice(e,1);break}a=d=null},setDefaultModule:function(a){this.defaultModule||(this.defaultModule=a),a=null}},Module.Manager.LazyLoader={prototype:{lazyLoadModules:function c(a,b){function d(){o.stopLazyLoadingModules&&o.stopLazyLoadingModules(),b&&n.merge(b),f(),g(),q.scrollTop||q.scrollLeft||(q=null)}function e(){return r&&(l(),r=s=q=null),p&&(clearTimeout(p),p=null),n&&(n.destructor(),n=null),o.stopLazyLoadingModules=o=null,this}function f(){r.addEventListener?(r.addEventListener("mouseover",i,!0),s.addEventListener("scroll",j,!0)):(r.attachEvent("onmouseover",i),r.onscroll=j)}function g(){var a,b,d=r.getElementsByTagName("*"),e=m.create(h());for(a=0;a<d.length;a++)b=d[a],b.getAttribute("data-module-lazyload")&&e.isVisible(b)&&c(b,"scrollto")}function h(){return null===q&&(q=s.body.scrollTop||s.body.scrollLeft?s.body:s.documentElement),q}function i(a){a=a||window.event,a.target=a.target||a.srcElement,a.target.getAttribute("data-module-lazyload")&&c(a.target,a.type)}function j(a){a=a||window.event,a.target=a.target||a.srcElement,p&&clearTimeout(p),p=setTimeout(k,n.scrollTimeout)}function k(){p=null,g()}function c(a,b){var c=a.getAttribute("data-module-lazyload");("any"===c||new RegExp(b).test(c))&&(a.removeAttribute("data-module-lazyload"),o.createModules(a),a.setAttribute("data-module-lazyloaded",c)),a=null}function l(){r.removeEventListener?(r.removeEventListener("mouseover",i,!0),s.removeEventListener("scroll",j,!0)):(r.detachEvent("onmouseover",i),s.detachEvent("onscroll",j))}function m(){}var n=new Hash({scrollElement:null,scrollTimeout:250}),o=this,p=null,q=n.scrollElement||null,r=a,s=r.ownerDocument;return m.prototype={bottom:0,height:0,left:0,right:0,top:0,width:0,constructor:m,isBottomInBounds:function(a){return a.top+a.height<=this.top+this.height&&a.top+a.height>this.top?!0:!1},isLeftInBounds:function(a){return a.left>=this.left&&a.left<this.left+this.width?!0:!1},isRightInBounds:function(a){return a.left+a.width<=this.left+this.width&&a.left+a.width>this.left?!0:!1},isTopInBounds:function(a){return a.top>=this.top&&a.top<this.top+this.height?!0:!1},isVisible:function(a){var b=!1,c=this._getPosition(a);return(this.isRightInBounds(c)||this.isLeftInBounds(c))&&(this.isTopInBounds(c)||this.isBottomInBounds(c))&&(b=!0),b},_getPosition:function(a){for(var b=a.offsetParent,c={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight};b=b.offsetParent;)c.top+=b.offsetTop,c.left+=b.offsetLeft;return c}},m.create=function(a){var b=new this;return b.top=a.scrollTop,b.left=a.scrollLeft,b.width=a.clientWidth,b.height=a.clientHeight,b.right=a.offsetWidth-(b.left+b.width),b.bottom=a.offsetHeight-b.top-b.height,b},d(),this.stopLazyLoadingModules=e,this}}},Module.Manager.include(Module.Manager.LazyLoader),Module.Manager.SubModuleProperties={included:function(a){a.addCallback&&a.addCallback("beforeReady","initSubModules")},prototype:{initSubModules:function(){if(!this.options.subModulesDisabled){this.elementStore.setConfig({collections:{subModules:{selector:"[data-module-property]",nocache:!0}}});var a,b=this.elementStore.getCollection("subModules"),c=0,d=b.length;for(c;d>c;c++)a=b[c].getAttribute("data-module-property"),this._createSubModuleProperty(a,b[c])}},_createSubModuleProperty:function(a,b){if(!a)throw new Error("Missing required argument: name");if(!b)throw new Error("Missing required argument: element");var c,d=this.constructor.getManager(),e=d.getModuleMetaData(b),f=this.constructor.prototype;if(e.types.length>1)throw new Error("Sub module elements cannot have more than one type specified in data-module");if(c=d.createModule(b,e.types[0],e.options),c.init(b),null===f[a]){if(this.hasOwnProperty(a))throw new Error("Error creating sub module. Property "+a+" already exists.");this[a]=c}else{if(!(f[a]instanceof Array))throw new Error("Cannot create module property "+a+". Property is neither null nor an Array in the class Prototype.");this.hasOwnProperty(a)||(this[a]=[]),this[a].push(c)}d.markModulesCreated(b,e),d=c=e=f=b=null}}},Module.include(Module.Manager.SubModuleProperties);var Application=Module.extend({prototype:{actions:{click:["createModule","publishEvent"]},config:null,logger:window.console||null,moduleManager:null,objectFactory:null,options:{actionPrefix:"app",subModulesDisabled:!0,focusAnythingInDefaultModule:!0},destructor:function(){this.moduleManager&&(this.moduleManager.destructor(!0),this.moduleManager=null),this.objectFactory&&(this.objectFactory.destructor(),this.objectFactory=null),this.config.handleApplicationErrors&&(this.window.onerror=null),this.logger=this.config=null,Module.prototype.destructor.call(this,!0)},_ready:function(){Module.prototype._ready.call(this),null===this.delegator.constructor.errorDelegate&&this.config.handleActionErrors&&(this.delegator.constructor.errorDelegate=this),this.config.handleApplicationErrors&&(this.window.onerror=this.handleError.bind(this));try{this.moduleManager.init(),this.config.eagerLoadModules&&this.moduleManager.eagerLoadModules(this.element),this.config.lazyLoadModules&&this.moduleManager.lazyLoadModules(this.element),this.subscribe("application.createModule",this,"handleCreateModule"),this.moduleManager.focusDefaultModule(this.options.focusAnythingInDefaultModule),this.publish("application.ready")}catch(a){if(!this.handleError(a))throw a}},configure:function(a,b){return a.call(b||this,this.config,this),this},createModule:function(a,b,c){a.stop(),this._createModuleFromConfig(c),a=b=c=null},_createModuleFromConfig:function(a){if(!a.module)throw new Error("Missing required config.module");if(!a.module.type)throw new Error("Missing required config.module.type");if(!a.module.template)throw new Error("Missing required config.module.template for type: "+a.module.type);a.module.options=a.module.options||{},a.container=a.container||{},a.container.insert=a.container.insert||"top",a.element=a.element||{},a.element.tag=a.element.tag||"div";var b=null,c=null,d="script[data-template="+a.module.template+"]",e=this.elementStore.querySelector(d),f=this.document.createElement(a.element.tag);if(!e)throw new Error("Failed to find new module template using selector: "+d);if(c=a.container.selector?this.elementStore.querySelector(a.container.selector):this.document.getElementsByTagName("body")[0],!c)throw new Error("Failed to find module container with selector: "+(a.container.selector||"body"));return b=this.moduleManager.createModule(f,a.module.type,a.module.options||{}),this.moduleManager.initModuleInContainer(f,c,a.container,e,a.module.type,b),b.focus(),event=f=a=c=rootElement=null,b},_getErrorObject:function _getErrorObject(errorMessage){var info=errorMessage.match(/^(([A-Za-z_][A-Za-z0-9._]*):)?(.+$)/),error=null,className,message,Klass;if(info)if(className=info[2]||"Error",message=(info[3]||errorMessage).replace(/^\s+|\s+$/g,""),/^[A-Za-z_][A-Za-z0-9._]*$/.test(className))try{Klass=eval(className),error=new Klass(message)}catch(error){throw new Error("Class '"+className+"' is either not found or not an object constructor function")}else error=new Error(message);else error=new Error(message);return error},handleActionError:function(a,b,c){if(!this.logger)throw c.error;this.logger.debug({event:a,element:b,params:c}),this.logger.error(c.error)},handleCreateModule:function(a){return this._createModuleFromConfig(a.data),!1},handleError:function(a){var b="string"==typeof a?this._getErrorObject(a):a;this._handleError(b)},_handleError:function(a){return this.logger?(this.logger.error(a),!0):!1},publishEvent:function(a,b,c){if(!c.event)throw new Error("Missing required argument params.event");a.stop(),this.constructor.publish(c.event,b,c.data||{})}}});