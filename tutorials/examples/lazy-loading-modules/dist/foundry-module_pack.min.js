/*! foundry 2014-05-16 */
(function(){var c=Module.Base.extend({prototype:{options:{charset:"utf-8",dataLabelKey:"label",dataRootKey:null,dataValueKey:"value",busyClass:"autofill-busy",busyText:"Please wait...",defaultText:"Choose",pendingClass:"autofill-pending",pendingText:"..."},onControllerRegistered:function(f,e){f.registerEvents("change")},populate:function d(f,e,j){var g=f.target,k=g.getAttribute("data-autofill-group"),i,h;if(!k){return}i=new b(this.element,k);h=i.getTarget(g);if(!h){return}this._fill(i,g,h)},_getValue:function(e){var g=null;if(e.multiple){g=[];for(var f=0;f<e.options.length;f++){if(e.options[f].selected){g.push(e.options[f].value)}}}else{g=e.value}return g},_fill:function(k,h,j){var l=new XMLHttpRequest(),e=h.getAttribute("data-autofill-url");method=(h.getAttribute("data-autofill-method")||"GET").toUpperCase(),param=h.getAttribute("data-autofill-param")||h.name,value=this._getValue(h),self=this,data=null,onreadystatechange=function(){if(this.readyState<4){return}else{if(this.status===200){success();complete()}else{if(this.status>=400){error();complete();throw new Error("Request to "+method+" "+e+" failed with status: "+this.status)}}}},success=function(){var i=l.getResponseHeader("content-type");if(/(text|application)\/json/i.test(i)){self._fillFromData(JSON.parse(l.responseText),k,h,j)}else{if(/text\/html/i.test(i)){self._fillFromHtml(l.responseText,k,h,j)}else{throw new Error("Unknown content-type: "+i)}}j.classList.remove(self.options.busyClass);j.disabled=false},error=function(){},complete=function(){k.destructor();l=l.onreadystatechange=self=k=h=j=null};this._markTargetBusy(j,k);if(!e){throw new Error("Missing required attribute: data-autofill-url ("+h.name+")")}if(value instanceof Array){data=[];for(var f=0,g=value.length;f<g;f++){data.push(this.window.encodeURIComponent(param)+"="+this.window.encodeURIComponent(value[f]))}data=data.join("&")}else{data=this.window.encodeURIComponent(param)+"="+this.window.encodeURIComponent(value)}if(method==="GET"){e+=(e.indexOf("?")===-1?"?":"&")+data}l.onreadystatechange=onreadystatechange;l.open(method,e);l.setRequestHeader("X-Requested-With","XMLHttpRequest");if(method==="POST"){l.setRequestHeader("Content-Type: application/x-www-form-urlencoded; charset="+this.options.charset)}l.send(data)},_fillFromData:function(g,o,e,k){g=this.options.dataRootKey?g[this.options.dataRootKey]:g;var l=this.options.dataLabelKey,n=this.options.dataValueKey,h=0,f=g.length,m=k.getAttribute("data-autofill-placeholder")||this.options.defaultText,j;a.emptyNode(k);j=a.createOption("",m,this.document);k.appendChild(j);for(h;h<f;h++){j=a.createOption(g[h][n],g[h][l],this.document);k.appendChild(j)}},_fillFromHtml:function(e,h,f,g){g.innerHTML=e},_markTargetBusy:function(f,e){f.classList.remove(this.options.pendingClass);f.classList.add(this.options.busyClass);f.options[0].innerHTML=this.options.busyText;f.disabled=true;e.forEachTarget(f,function(g){a.emptyNode(g);g.appendChild(a.createOption("",this.options.pendingText,this.document));g.classList.remove(this.options.busyClass);g.classList.add(this.options.pendingClass);g.disabled=true},this)}}});function b(f,e){this.element=f||null;this.name=e||null}b.prototype={element:null,name:null,_selects:null,constructor:b,destructor:function(){this._selects=this.element=null},getSelects:function(){return this._selects||(this._selects=this.element.querySelectorAll("select[data-autofill-group="+this.name+"]"))},getTarget:function(f){var j=f.getAttribute("data-autofill-target"),h=this.getSelects(),g=0,e=null;if(j){for(g;g<h.length;g++){if(h[g].name===j){e=h[g];break}}}return e},forEachTarget:function(e,h,f){f=f||this;var g=e;while(g=this.getTarget(g)){if(h.call(f,g,e,this)===false){break}}}};var a={createOption:function(h,f,e){var g=e.createElement("option");g.value=h;g.innerHTML=f;return g},emptyNode:function(e){while(e.childNodes.length){e.removeChild(e.lastChild)}}};Module.AutoFillSelectModule=c})();Module.DetailsModule=Module.Base.extend({prototype:{identifierPrefix:"details",lastRequest:null,options:{autoLoad:true,url:null,method:"GET",view:null,identifier:null},view:null,xhr:null,_ready:function(){Module.Base.prototype._ready.call(this);if(!this.options.url){throw new Error("Missing required option: url")}if(this.options.identifier){this.subscribe(this.identifierPrefix+"."+this.options.identifier+".changed",this,this.handleDetailsChanged)}if(this.options.autoLoad){this._loadFromUrl(this.options.url,this.options.method,this.element)}},destructor:function(a){if(this.xhr){this.xhr.abort();this.xhr=null}this.lastRequest=null;Module.Base.prototype.destructor.call(this,a)},close:function click(b,a,c){b.stop();this.destructor()},_getView:function(){return this.options.view||this.view},handleDetailsChanged:function(a,b){this._retry(this.lastRequest)},load:function click(c,b,d){if(d.stop){c.stop()}else{c.preventDefault()}var a=b.getAttribute("href")||b.getAttribute("data-details-url"),e=b.getAttribute("data-details-method")||"GET";this._loadFromUrl(a,e,this.element)},_loadFromUrl:function(b,a,d){this.lastRequest={url:b,method:a,target:d};this._loading(d);if(this.xhr){this.xhr.abort()}var h=new XMLHttpRequest(),i=this,j=function(){var l=h.getResponseHeader("content-type");if(/text\/html/.test(l)){d.innerHTML=h.responseText;c()}else{if(/(text|application)\/json/.test(l)){var k=i._getView();if(!k){throw new Error("Missing one of view or options.view")}i.render(k,JSON.parse(h.responseText),d).done(function(){c()})}else{c();throw new Error("Unknown HTTP response type: "+l)}}},f=function(){d.innerHTML=h.responseText;c()},e=function(){i.element.innerHTML=['<p class="details-error">',"An unknown problem occurred. ",'<button type="button" data-actions="'+i.controllerId+'.retry">Try Again</button>',"</p>"].join("");c()},c=function(){i._loaded(d);d=h=h.onreadystatechange=i=i.xhr=null},g=function(){if(this.readyState===4){if(this.status===200){j()}else{if(this.status===404){f()}else{e()}}}};this.xhr=h;h.onreadystatechange=g;h.open(a,b);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.send(null)},_retry:function(a){this._loadFromUrl(a.url,a.method,a.target)},retry:function click(b,a,c){b.stop();this._retry(this.lastRequest)}}});Module.FormModule=Module.Base.extend({prototype:{callbacks:{beforeReady:["initExtractor","initSerializerFactory"]},extractor:null,options:{"extractor.allowNulls":false,"extractor.flat":false},serializerFactory:null,initExtractor:function initExtractor(){this.extractor=this.extractor||new Reaper();this.extractor.allowNulls=this.options["extractor.allowNulls"];this.extractor.flat=this.options["extractor.flat"]},initSerializerFactory:function initSerializerFactory(){this.serializerFactory=this.serializerFactory||Cerealizer},_afterSubmit:function _afterSubmit(a){a=null},_beforeSubmit:function _beforeSubmit(c,b,a,d){c=b=a=d=null;return true},handleClickSubmit:function click(b,a,c){this.submit(b,a,c)},handleEnterpress:function enterpress(b,a,c){this.submit(b,a,c)},_getData:function _getData(){return this.extractor.getData(this.element)},_getTransport:function _getTransport(){return new XMLHttpRequest()},onControllerRegistered:function(b,a){b.registerEvents("enterpress")},onControllerUnregistered:function(a){},_sendRequest:function _sendRequest(g){var k=this._getTransport(),d=this.element.getElementsByTagName("form")[0]||this.element,a=(d.getAttribute("method")||d.getAttribute("data-form-method")||"POST").toUpperCase(),b=d.getAttribute("action")||d.getAttribute("data-form-action"),j=d.getAttribute("enctype")||d.getAttribute("data-form-enctype")||"queryString",e=this,h=this.serializerFactory.getInstance(j),f=h.serialize(g);if(!b){throw new Error("Missing required attribute: action or data-form-action")}var i=function(){if(this.readyState!==4){return}if(this.status<300||this.status>399){e.element.innerHTML=this.responseText;c()}};var c=function(){e._loaded();e._afterSubmit(k);e=g=event=element=f=k=k.onreadystatechange=d=null};if(a==="GET"){b+=/\?/.test(b)?f:"?"+f;f=null}k.open(a,b,true);k.setRequestHeader("X-Requested-With","XMLHttpRequest");if(j){k.setRequestHeader("Content-Type",j)}this._loading();k.onreadystatechange=i;k.send(f)},submit:function submit(b,a,d){b.stop();var c=this._getData();if(this._beforeSubmit(c,b,a,d)){this._sendRequest(c)}}}});Module.InfiniteScrollModule=Module.Base.extend({prototype:{averagePageHeight:-1,disabled:false,offset:0,options:{autoCheckScrollPosition:true,charset:"utf-8",limit:10,limitParam:"limit",method:"GET",offsetParam:"offset",pageClassName:"infiniteScroll-page",period:200,threshold:500,url:null,view:null},_newPageTagNames:{table:"tbody",ol:"li",ul:"li"},pageContainer:null,scrollTimer:null,totalHeight:0,_ready:function(){Module.Base.prototype._ready.call(this);if(!this.options.url){throw new Error("Missing required option: url")}this.elementStore.returnNative=true;this.handleScroll=this.handleScroll.bind(this);this.checkScrollPosition=this.checkScrollPosition.bind(this);this.pageContainer=this.element.querySelector(".infiniteScroll-container");this.enable()},destructor:function(a){if(this.element){this.disable()}Module.Base.prototype.destructor.call(this,a)},checkScrollPosition:function(){this.scrollTimer=null;if(this._nearThreshold()){this._search()}},_createNewPage:function(){var nodeName=this.pageContainer.nodeName.toLowerCase(),tagName=this._newPageTagNames[nodeName]||"div",page=this.document.createElement(tagName);if(tagName==="tbody"){with(page.insertRow(0)){with(insertCell(0)){style.height=this._getAveragePageHeight()+"px"}}}else{page.style.height=this._getAveragePageHeight()+"px"}page.className=this.options.pageClassName+" loading";return page},disable:function(){this.disabled=true;if(this.scrollTimer){this.window.clearTimeout(this.scrollTimer)}this.element.removeEventListener("scroll",this.handleScroll,false)},enable:function(){this.element.addEventListener("scroll",this.handleScroll,false);if(this.options.autoCheckScrollPosition){this.checkScrollPosition()}this.disabled=false},_getAveragePageHeight:function(){if(this.averagePageHeight<0){var a=this._getPages(),b=0,d=a.length,c=0;for(b;b<d;b++){c+=a[b].offsetHeight}this.totalHeight=c;this.averagePageHeight=Math.round(c/a.length)}return this.averagePageHeight},_getPages:function(){return this.pageContainer.querySelectorAll("."+this.options.pageClassName)},handleScroll:function(a){console.log("scrolled");if(this.scrollTimer){this.window.clearTimeout(this.scrollTimer)}this.scrollTimer=this.window.setTimeout(this.checkScrollPosition,this.options.period)},_nearThreshold:function(){return(this.element.scrollHeight-this.element.clientHeight-this.element.scrollTop<=this.options.threshold)},_search:function(){var e=this.offset++,d=this.options.offsetParam,a=this.options.limit,c=this.options.limitParam,b=this.window.escape(c)+"="+a+"&"+this.window.escape(d)+"="+e;url=this.options.url,method=(this.options.method||"GET").toUpperCase(),xhr=new XMLHttpRequest(),page=this._createNewPage(),self=this,onreadystatechange=function(){if(this.readyState<4){return}else{if(this.status===200){success();complete()}else{if(this.status===404){page.parentNode.removeChild(page);self.offset--;self.disable();complete()}else{if(this.status>=400){complete();throw new Error("Request "+method+" "+url+" failed with status: "+xhr.status)}}}}},success=function(){var f=xhr.getResponseHeader("content-type");if(/text\/html/i.test(f)){page.innerHTML=xhr.responseText;afterPageRendered()}else{if(/(application|text)\/json/i.test(f)){if(!self.options.view){throw new Error("Missing required option: view")}self.render(self.options.view,JSON.parse(xhr.responseText),page).done(afterPageRendered)}else{throw new Error("Unknown content-type: "+f)}}},afterPageRendered=function(){page.style.height="";self._loaded(page);self._updateAverageHeight(page)},complete=function(){xhr=xhr.onreadystatechange=page=self=null};this.pageContainer.appendChild(page);if(method==="GET"){url+=((url.indexOf("?")===-1)?"?":"&")+b}xhr.onreadystatechange=onreadystatechange;xhr.open(method,url);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");if(method==="POST"){xhr.setRequestHeader("Content-Type: application/x-www-form-urlencoded; charset="+this.options.charset);xhr.send(b)}else{xhr.send(null)}},_updateAverageHeight:function(a){this.totalHeight+=a.offsetHeight;this.averagePageHeight=Math.round(this.totalHeight/(this.offset+1))}}});Module.SelectionModule=Module.Base.extend({prototype:{elementStore:{elements:{list:{selector:"ol.selection-items"},removedItemList:{selector:"ol.selection-removed-items"}},collections:{items:{selector:"ol.selection-items>li"},selectedItems:{selector:"ol.selection-items>li.selected",nocache:true}}},options:{listTagName:"ol",selectedClass:"selected",hideOnRemoval:false,destroyHiddenFieldRegex:/_destroy\]$/,destroyHiddenFieldValue:1,confirmOnRemove:false,singleRemovalConfirm:"Are you sure you want to remove this item?",bulkRemovalConfirm:"Are you sure you want to remove these items?"},_ready:function(){Module.Base.prototype._ready.call(this);this.elementStore.returnNative=true;if(this.options.hideOnRemoval&&!this.removedItemList()){var a=this.document.createElement("ol");a.className="selection-removed-items";a.style.display="none";this.element.appendChild(a)}},deselectAll:function click(e,c,f){e.preventDefault();var a=this.items(),b=0,d=a.length;for(b;b<d;b++){a[b].classList.remove(this.options.selectedClass)}this.notify("selectionSizeChanged")},remove:function click(c,a,d){c.stop();var b=a.parentNode;if(!this.options.confirmOnRemove||this.window.confirm(d.confirm||this.options.singleRemovalConfirm)){while(b&&b.nodeName!="LI"){b=b.parentNode}if(b){this.removeItem(b)}else{throw new Error("Failed to find an item to remove")}}},removeAll:function click(b,a,d){b.preventDefault();if(!this.options.confirmOnRemove||this.window.confirm(d.confirm||this.options.bulkRemovalConfirm)){var c=this.list();while(c.childNodes.length){if(c.firstChild.nodeName==="LI"){this.removeItem(c.firstChild)}else{c.removeChild(c.firstChild)}}}},removeSelected:function click(d,c,e){d.preventDefault();if(!this.options.confirmOnRemove||this.window.confirm(e.confirm||this.options.bulkRemovalConfirm)){var a=this.selectedItems(),b=a.length;while(b--){this.removeItem(a[b])}}},selectAll:function click(e,c,f){e.preventDefault();var a=this.items(),b=0,d=a.length;for(b;b<d;b++){a[b].classList.add(this.options.selectedClass)}this.notify("selectionSizeChanged")},toggle:function click(b,a,c){if(c.stop){b.stop()}else{b.preventDefault()}a.classList.toggle(this.options.selectedClass);this.notify("selectionSizeChanged")},addItem:function(a){this.list().appendChild(a);this.clearElementStoreCache();this.notify("itemAdded",{item:a})},createItem:function(){var a=this.document.createElement("li");a.setAttribute("data-actions",this.controllerId+".toggle");return a},getSelectedItems:function(){return this.selectedItems()},getSelectionSize:function(){return this.selectedItems().length},removeItem:function(d,e,f){this.list().removeChild(d);if(this.options.hideOnRemoval){var a=d.querySelectorAll("input[type=hidden]"),b=0,c=a.length;for(b;b<c;b++){if(this.options.destroyHiddenFieldRegex.test(a[b].name)){a[b].value=this.options.destroyHiddenFieldValue;break}}this.removedItemList().appendChild(d)}if(!e){this.clearElementStoreCache()}if(!f){this.notify("itemRemoved",{item:d})}}}});Module.SlideshowModule=function(){var c=1000;var g=Module.Base.extend({self:{_defaultSlideFactory:null,getDefaultSlideFactory:function(){return this._defaultSlideFactory||(this._defaultSlideFactory=new h())}},prototype:{KEY_CODE_ESCAPE:27,KEY_CODE_LEFT:37,KEY_CODE_RIGHT:39,KEY_CODE_SPACEBAR:32,captionsEnabled:true,currentSlide:null,elementStore:{elements:{disableCaptionsButton:{selector:".slideshow-tool-captions-off"},enableCaptionsButton:{selector:".slideshow-tool-captions-on"},fullScreenNote:{selector:"em.slideshow-fullscreen-note"},pauseButton:{selector:".slideshow-tool-pause"},playButton:{selector:".slideshow-tool-play"},slideContainer:{selector:".slideshow-container"},toolbar:{selector:".slideshow-tools"}}},fullScreenNoteTimer:null,options:{autoPlay:false,delay:5000,fullScreenNoteDelay:3000,loop:true,method:null,toggleFullScreenDelay:100,url:null,view:null,zIndex:0},playTimer:null,slideFactory:null,transition:null,_ready:function(){Module.Base.prototype._ready.call(this);this.elementStore.returnNative=true;this.transition=this.transition||new d();this.slideFactory=this.slideFactory||g.getDefaultSlideFactory();this.playButton().style.display="";this.pauseButton().style.display="none";this._setZIndex(this.options.zIndex||c++);this.handleKeyUp=this.handleKeyUp.bind(this);if(this.options.url){this._loadFromUrl()}else{this._createFirstSlide()}},destructor:function(i){if(this.document){this.document.removeEventListener("keyup",this.handleKeyUp,false)}if(this.playTimer){this._stopSlideshow()}if(this.fullScreenNoteTimer){this.window.clearTimeout(this.fullScreenNoteTimer);this.fullScreenNoteTimer=null}this.slideFactory=this.currentSlide=this.transition=null;Module.Base.prototype.destructor.call(this,i)},captionsOff:function f(j,i,k){j.stop();this.captionsEnabled=false;this.disableCaptionsButton().style.display="none";this.enableCaptionsButton().style.display="";this._setCurrentSlide(this.currentSlide)},captionsOn:function f(j,i,k){j.stop();this.captionsEnabled=true;this.disableCaptionsButton().style.display="";this.enableCaptionsButton().style.display="none";this._setCurrentSlide(this.currentSlide)},enterFullScreen:function f(j,i,k){j.stop();this.showFullScreen()},exitFullScreen:function f(j,i,k){j.stop();this.showSmallScreen()},next:function f(j,i,k){j.stop();this._stopSlideshow();this._showNextSlide()},pause:function f(j,i,k){j.stop();this._stopSlideshow()},play:function f(j,i,k){j.stop();this._playSlideshow()},prev:function f(j,i,k){j.stop();this._stopSlideshow();this._showPrevSlide()},_createFirstSlide:function(){this._loaded();this._setCurrentSlide(this.slideFactory.create(this.slideContainer()));if(!this.currentSlide){throw new Error("No slides were found")}if(this.options.autoPlay){this._playSlideshow()}},handleHideFullScreenNote:function(){this.fullScreenNote().style.display="none";this.fullScreenNoteTimer=null},handleKeyUp:function(i){var j=i.keyCode;if(this.KEY_CODE_ESCAPE===j){this.showSmallScreen()}else{if(this.KEY_CODE_LEFT===j){this._stopSlideshow();this._showPrevSlide()}else{if(this.KEY_CODE_RIGHT===j){this._stopSlideshow();this._showNextSlide()}else{if(this.KEY_CODE_SPACEBAR===j){if(this.playTimer){this._stopSlideshow()}else{this._playSlideshow()}}}}}},handleShowNextSlide:function(){this._showNextSlide();this._playSlideshow()},_loadFromUrl:function(){this._loading(this.slideContainer());var k=this.options.url,o=(this.options.method||"GET").toUpperCase(),n=new XMLHttpRequest(),j=this,l=function(){if(this.readyState<4){return}else{if(this.status===200){m()}else{if(this.status>=400){i();throw new Error("Request to "+o+" "+k+" failed with status: "+this.status)}}}},m=function(){var p=n.getRequestHeader("content-type");if(/(application|text)\/json/i.test(p)){j.render(j.options.view,JSON.parse(n.responseText),j.slideContainer()).done(function(){j._loaded(j.slideContainer());i()})}else{if(/test\/html/i.test(p)){j.slideContainer().innerHTML=n.responseText;i()}}},i=function(){n=j=null};n.onreadystatechange=l;n.open(o,k);n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.send(null)},_playSlideshow:function(){this.playButton().style.display="none";this.pauseButton().style.display="";this.playTimer=this.window.setTimeout(this.handleShowNextSlide.bind(this),this.options.delay)},_setCurrentSlide:function(i){if(this.currentSlide){this.currentSlide.removeClass("slideshow-current")}if(this.captionsEnabled){i.showCaption()}else{i.hideCaption()}i.addClass("slideshow-current");this.currentSlide=i},_setZIndex:function(i){this.options.zIndex=this.element.style.zIndex=this.slideContainer().style.zIndex=i;this.fullScreenNote().style.zIndex=i+1},showFullScreen:function(){this.fullScreenNote().style.display="";this.element.classList.add("slideshow-fullscreen");this._toggleImageUrls("data-fullscreen-src","data-smallscreen-src");this._setZIndex(this.options.zIndex+100);this.document.addEventListener("keyup",this.handleKeyUp,false);this.fullScreenNoteTimer=this.window.setTimeout(this.handleHideFullScreenNote.bind(this),this.options.fullScreenNoteDelay)},_showNextSlide:function(){if(this.transitioning){return}var j=this.currentSlide,i=j.nextSlide();if(!i&&this.options.loop){i=j.firstSlide()}if(i){this._transition(j,i,1)}},_showPrevSlide:function(){if(this.transitioning){return}var j=this.currentSlide,i=this.currentSlide.prevSlide();if(!i&&this.options.loop){i=this.currentSlide.lastSlide()}if(i){this._transition(j,i,-1)}},showSmallScreen:function(){this.window.clearTimeout(this.fullScreenNoteTimer);this.fullScreenNoteTimer=null;this.element.classList.remove("slideshow-fullscreen");this.fullScreenNote().style.display="none";this._toggleImageUrls("data-smallscreen-src","data-fullscreen-src");this._setZIndex(this.options.zIndex-100);this.document.removeEventListener("keyup",this.handleKeyUp,false)},_stopSlideshow:function(){if(this.playTimer){this.playButton().style.display="";this.pauseButton().style.display="none";this.window.clearTimeout(this.playTimer);this.playTimer=null}},_toggleImageUrls:function(m,o){var j=this.slideContainer().querySelectorAll("img["+m+"]"),n=0,p=j.length,l=this,k=this.options.toggleFullScreenDelay,q=function(){j[n].setAttribute(o,j[n].src);j[n].src=j[n].getAttribute(m);n++;if(n<p){l.window.setTimeout(q,k)}else{j=event=element=params=q=null}};this.window.setTimeout(q,k)},_transition:function(k,j,i){if(!this.transition){return}else{if(this.transitioning){this.transition.stop()}}this.transitioning=true;this.transition.start(k,j,i,function(){this.transitioning=false;this._setCurrentSlide(j);if(this._playTimer){this._playSlideshow()}},this)}}});function h(){}h.prototype={constructor:h,create:function(k){var i=null,l=null,j=null;switch(k.nodeName){case"DL":l=k.querySelector("dt");j=k.querySelector("dd");i=new a(k,l,j);break;case"DIV":l=k.querySelector("a, img");j=k.querySelector("figcaption");i=new e(k,l,j);break;default:break}return i}};function b(i,k,j){this.setContainer(i);this.setImage(k);this.setCaption(j)}b.prototype={caption:null,container:null,image:null,next:null,prev:null,constructor:b,addClass:function(i){return this._alterClassName("add",i)},_alterClassName:function(j,i){this.image.classList[j](i);if(this.caption){this.caption.classList[j](i)}return this},_createNextSlide:function(){throw new Error("Not Implemented")},_createPrevSlide:function(){throw new Error("Not Implemented")},_findNextSibling:function(j,i){var k=j;while(k=k.nextSibling){if(i.test(k.nodeName)){break}}return k},_findPrevSibling:function(j,i){var k=j;while(k=k.previousSibling){if(i.test(k.nodeName)){break}}return k},firstSlide:function(){var i=this,j=this;while(i=i.prevSlide()){j=i}return j},getTransitionElements:function(){throw new Error("Not Implemented")},hideCaption:function(){if(this.caption){this.caption.style.display="none"}return this},lastSlide:function(){var i=this,j=this;while(i=i.nextSlide()){j=i}return j},nextSlide:function(){if(!this.next){this.next=this._createNextSlide()}return this.next},prevSlide:function(){if(!this.prev){this.prev=this._createPrevSlide()}return this.prev},removeClass:function(i){return this._alterClassName("remove",i)},setCaption:function(i){this.caption=i;return this},setImage:function(i){this.image=i;return this},showCaption:function(){if(this.caption){this.caption.style.display=""}return this},setContainer:function(i){this.container=i;return this}};var a=b.extend({prototype:{initialize:function(i,k,j){b.call(this,i,k,j)},getTransitionElements:function(){return this.caption?[this.image,this.caption]:[this.image]},_createNextSlide:function(){var k=this._findNextSibling(this.caption,/DT/),j=null,i=null;if(k){j=this._findNextSibling(k,/DD/);i=new a(this.container,k,j)}return i},_createPrevSlide:function(){var k=this._findPrevSibling(this.image,/DD|DT/),l=null,j=null,i=null;if(k){if(k.nodeName==="DD"){j=k;l=this._findPrevSibling(j,/DT/);i=new a(this.container,l,j)}else{l=k;j=this._findNextSibling(l,/DD/);i=new a(this.container,l,j)}}return i}}});var e=b.extend({prototype:{figure:null,initialize:function(i,k,j){b.call(this,i,k,j)},getTransitionElements:function(){return[this.figure]},_alterClassName:function(j,i){this.figure.classList[j](i)},_createNextSlide:function(){var j=this._findNextSibling(this.figure,/FIGURE/),l=null,k=null,i=null;if(j){l=j.querySelector("a, img");k=j.querySelector("figcaption");i=new e(this.container,l,k)}return i},_createPrevSlide:function(){var j=this._findPrevSibling(this.figure,/FIGURE/),l=null,k=null,i=null;if(j){l=j.querySelector("a, img");k=j.querySelector("figcaption");i=new e(this.container,l,k)}return i},setCaption:function(i){b.prototype.setCaption.call(this,i);this.figure=i.parentNode}}});function d(){}d.prototype={callback:null,context:null,constructor:d,_toggle:function(k,l){for(var j=0;j<k.length;j++){k[j].style.display=l}},start:function(m,l,j,k,i){this.callback=k;this.context=i;this._toggle(m.getTransitionElements(),"none");this._toggle(l.getTransitionElements(),"block");k.call(i,this)},stop:function(){this.callback.call(this.context,this)}};g.AbstractSlide=b;g.FigureSlide=e;g.DefinitionListSlide=a;g.SlideFactory=h;g.ShowHideTransition=d;return g}();